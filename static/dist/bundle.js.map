{"version":3,"file":"bundle.js","sources":["../js/validUrl.js","../js/linkBoxes.js","../js/newLink.js","../js/preLinkMark.js","../js/shared.js","../js/copyPasteEvents.js","../js/index.js"],"sourcesContent":["// https://github.com/ogt/valid-url\n\n\n/**\n * URI spitter method - direct from RFC 3986\n * @param {string} link uri e.g. 'https://www.google.com'\n * @returns URI object with properties uri, scheme, authority, path, query, fragment.\n */\nexport const splitUri = (link) => {\n  const splitted = link.match(/(?:([^:\\/?#]+):)?(?:\\/\\/([^\\/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?/);\n  const uri = splitted[0];\n  const scheme = splitted[1];\n  const authority = splitted[2];\n  const path = splitted[3];\n  const query = splitted[4];\n  const fragment = splitted[5];\n  return {\n    uri,\n    scheme,\n    authority,\n    path,\n    query,\n    fragment,\n  };\n};\n\nexport const isUri = (value) => {\n  if (!value) {\n    return;\n  }\n\n  // check for illegal characters\n  if (/[^a-z0-9\\:\\/\\?\\#\\[\\]\\@\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=\\.\\-\\_\\~\\%]/i.test(value)) return;\n\n  // check for hex escapes that aren't complete\n  if (/%[^0-9a-f]/i.test(value)) return;\n  if (/%[0-9a-f](:?[^0-9a-f]|$)/i.test(value)) return;\n\n  let splitted = [];\n  let scheme = '';\n  let authority = '';\n  let path = '';\n  let query = '';\n  let fragment = '';\n  let out = '';\n\n  // from RFC 3986\n  splitted = splitUri(value);\n  scheme = splitted.scheme;\n  authority = splitted.authority;\n  path = splitted.path;\n  query = splitted.query;\n  fragment = splitted.fragment;\n\n  // if authority is present, the path must be empty or begin with a /\n  if (authority && authority.length) {\n    if (!(path.length === 0 || /^\\//.test(path))) return;\n  } else {\n    // if authority is not present, the path must not start with //\n    if (/^\\/\\//.test(path)) return;\n  }\n\n  if (scheme && scheme.length) {\n    // scheme must begin with a letter, then consist of letters, digits, +, ., or -\n    if (!/^[a-z][a-z0-9\\+\\-\\.]*$/.test(scheme.toLowerCase())) return;\n  }\n\n  // re-assemble the URL per section 5.3 in RFC 3986\n  if (scheme && scheme.length) {\n    out += `${scheme}:`;\n  }\n  if (authority && authority.length) {\n    out += `//${authority}`;\n  }\n\n  out += path;\n\n  if (query && query.length) {\n    out += `?${query}`;\n  }\n\n  if (fragment && fragment.length) {\n    out += `#${fragment}`;\n  }\n\n  return out;\n};\n","import * as validUrl from './validUrl';\n\nlet padOuter;\nconst getPadOuter = () => (padOuter = padOuter || $('iframe[name=\"ace_outer\"]').contents()); // finds the ace_outer iframe and assigns its contents to padOuter, then returns it\n\n/**\n * @returns wrapper for all the link modals on the page\n */\nexport const getLinksContainer = () => getPadOuter().find('#linkBoxWrapper');\n\n/* ***** Public methods: ***** */\n\n/**\n * Displays the parent div of a specific link modal.\n * @param {string} linkId   ID of a specific link\n */\nexport const showLink = (linkId) => getLinksContainer().find(`#${linkId}`).show();\n\n/**\n * Hides the parent div of a specific link modal.\n * @param {string} linkId   ID of a specific link\n */\nexport const hideLink = (linkId) => {\n  getLinksContainer().find(`#${linkId}`).hide(); // hides the entire modal (highest in hierarchy)\n  padOuter.find(`#show-form-${linkId}`).show(); // removes display:none from the link info viewer\n  padOuter.find(`#edit-form-${linkId}`).hide(); // adds display:none to link editor (accessed throughh pen icon on show-form-linkId)\n};\n\n/**\n * Hides all link modals on the page.\n */\nexport const hideAllLinks = () => getLinksContainer().find('.link-container').hide();\n\n\nconst getPosition = (e) => {\n  let posx = 0;\n  let posy = 0;\n\n  if (!e) e = window.event;\n\n  if (e.pageX || e.pageY) {\n    posx = e.pageX;\n    posy = e.pageY;\n  } else if (e.clientX || e.clientY) {\n    posx = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;\n    posy = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;\n  }\n\n  return {x: posx, y: posy};\n};\n\n\nconst setPositionModal = (e, linkModal, padInner) => {\n  const clickCoords = getPosition(e);\n  const clickCoordsX = clickCoords.x;\n  const clickCoordsY = clickCoords.y;\n\n  const modalWith = linkModal.innerWidth();\n  const modalHeight = linkModal.outerHeight(true);\n\n  const windowWidth = padInner.innerWidth();\n  const windowHeight = padInner.outerHeight(true);\n\n  const windoPaddingTop = parseInt(padInner.css('padding-top'));\n  const linkElementTop = parseInt($(e.target).offset().top);\n  const linkElementHeight = parseInt($(e.target).outerHeight(true));\n\n  let newL = e.clientX + padInner.offset().left;\n  let newT = linkElementTop + linkElementHeight + (windoPaddingTop / 2);\n\n  if ((windowWidth - clickCoordsX) < modalWith) {\n    // reverse position\n    newL -= modalWith;\n  }\n\n  if ((windowHeight - clickCoordsY) < modalHeight) {\n    newT = windowHeight - modalHeight;\n  }\n\n  if (!$('body').hasClass('mobileView')) {\n    newT += e.target.offsetHeight + 2;\n  }\n\n  if ($('body').hasClass('mobileView')) {\n    linkModal.css({\n      left: '50%',\n      top: `${newT}px`,\n      transform: 'translateX(-50%)',\n      width: '96vw',\n    });\n    linkModal.find('a.ep_hyperlink_title').css({\n      'margin-left': '4px',\n    });\n    linkModal.find('.ep_hyperlink_docs_bubble_button_container').css({\n      'margin-left': 'auto',\n    });\n  } else {\n    linkModal.css({left: `${newL}px`, top: `${newT}px`});\n  }\n};\n\n\nexport const showLinkModal = (e, linkObj, socket) => {\n  const padOuter = $('iframe[name=\"ace_outer\"]').contents();\n  const padInner = getPadOuter().find('iframe[name=\"ace_inner\"]');\n  const linkId = linkObj.linkId;\n  const linkModalAppended =\n    getLinksContainer().find(`#${linkId}`).length === 0 ? false : true;\n\n  hideAllLinks();\n\n  if (!linkObj.hyperlink) {\n    console.error('[hyperlink]: link does not exist', linkObj);\n    return false;\n  }\n\n  // find link modal, if does not exist create a link modal\n  let linkModal = getLinksContainer().find(`#${linkId}`);\n  if (!linkModalAppended) linkModal = $('#linkBoxTemplate').tmpl({...linkObj});\n\n  const loaded = linkModal.attr('data-loaded');\n\n  // if the linkModal was not appended, create a modal and append it to #linkBoxWrapper\n  if (!linkModalAppended) {\n    padOuter.find('#linkBoxWrapper').append(linkModal);\n  } else {\n    // if the modal was exist update text and hypertext\n    linkModal.show();\n    // if the old hyperlink was not same as new hyperlink\n    if (linkObj.hyperlink !== linkModal.find('a.ep_hyperlink_title').attr('href')) {\n      linkModal.attr('data-loaded', 'false');\n    }\n\n    linkModal.attr('data-hyperlink', linkObj.hyperlink);\n    linkModal.find('input#hyperlink-url').val(linkObj.hyperlink);\n\n    linkModal.find('a.ep_hyperlink_title').attr({\n      title: linkObj.hyperlink,\n      href: linkObj.hyperlink,\n    });\n  }\n\n  // If the text we saved has changed and is different from the contents of the pad\n  const text = padInner.contents().find(`.${linkId}`).text();\n  linkModal.find('input#hyperlink-text-hidden').val(text);\n  linkModal.find('input#hyperlink-text').val(text);\n\n  // TODO: 1/ hyperlink for social and\n  // TODO: 2/ inside link\n  if (loaded !== 'true') {\n    let hyperlink = linkObj.hyperlink || linkModal.attr('data-hyperlink');\n    let dividedUrl;\n\n    try {\n      dividedUrl = new URL(hyperlink);\n    } catch (error) {\n      console.error(`[hyperlink]: ${error}`);\n      hideLink(linkId);\n      return;\n    }\n\n    const ep_hyperlink_img = linkModal.find('#ep_hyperlink_img');\n    const ep_hyperlink_title = linkModal.find('a.ep_hyperlink_title');\n    const card_loading_hyperlink = linkModal.find('#card_loading_hyperlink');\n    const ep_hyperlink_description = linkModal.find(\n        '#ep_hyperlink_description'\n    );\n\n    ep_hyperlink_description.text('');\n    ep_hyperlink_title.text(hyperlink);\n\n    ep_hyperlink_img.hide();\n    ep_hyperlink_title.show();\n    card_loading_hyperlink.show();\n\n    // raise for og:title resolving\n\n    if (!/^http:\\/\\//.test(hyperlink) && !/^https:\\/\\//.test(hyperlink)) {\n      hyperlink = `https://${hyperlink}`;\n    }\n\n    const changeMetaView = (hyperlink, title, image) => {\n      ep_hyperlink_img.attr('src', image);\n      ep_hyperlink_img.on('load', () => {\n        card_loading_hyperlink.fadeOut(500, () => {\n          ep_hyperlink_img.fadeIn();\n          ep_hyperlink_title.text(\n              title.replace(/^(?:https?:\\/\\/)?(?:www\\.)?/i, '')\n          );\n          ep_hyperlink_description.text(\n              hyperlink.replace(/^(?:https?:\\/\\/)?(?:www\\.)?/i, '')\n          );\n          linkModal.attr({'data-loaded': true});\n        });\n      });\n    };\n\n    if (!validUrl.isUri(hyperlink)) {\n      const img =\n        '../static/plugins/ep_full_hyperlinks/static/dist/img/nometa.png';\n      changeMetaView(hyperlink, hyperlink, img);\n      return false;\n    }\n    // ........\n    const metaResolverCallBack = (result) => {\n      if (result.metadata.image && result.metadata.title) {\n        changeMetaView(\n            hyperlink,\n            result.metadata.title,\n            result.metadata.image\n        );\n      } else {\n        const editedHyperlink = `https://${dividedUrl.hostname}`;\n        if (result.last !== true) {\n          socket.emit(\n              'metaResolver',\n              {padId: clientVars.padId, editedHyperlink, last: true},\n              metaResolverCallBack\n          );\n        } else {\n          changeMetaView(\n              hyperlink,\n              result.metadata.title || hyperlink,\n              '../static/plugins/ep_full_hyperlinks/static/dist/img/nometa.png'\n          );\n        }\n      }\n    };\n    // ........\n    if (dividedUrl.hostname.indexOf('twitter.com') >= 0) {\n      changeMetaView(\n          hyperlink,\n          'Twitter',\n          '../static/plugins/ep_full_hyperlinks/static/dist/img/twitter.png'\n      );\n    } else if (dividedUrl.protocol.indexOf('mailto') >= 0) {\n      changeMetaView(\n          hyperlink,\n          'Send email',\n          '../static/plugins/ep_full_hyperlinks/static/dist/img/envelope.svg'\n      );\n    } else if (dividedUrl.protocol.indexOf('skype') >= 0) {\n      changeMetaView(\n          hyperlink,\n          'Open Skype',\n          '../static/plugins/ep_full_hyperlinks/static/dist/img/skype.svg'\n      );\n    } else {\n      socket.emit(\n          'metaResolver',\n          {padId: clientVars.padId, hyperlink, last: false},\n          metaResolverCallBack\n      );\n    }\n  }\n\n  setPositionModal(e, linkModal, padInner);\n  linkModal.addClass('hyperlink-display');\n};\n\n// Indicates if event was on one of the elements that does not close link\nexport const shouldNotCloseLink = (e) => {\n  // a link box\n  if (\n    $(e.target).closest('.link').length ||\n    $(e.target).closest('.link-modal').length ||\n    $(e.target).closest('.ep_hyperlink_docs_bubble_button_edit').length ||\n    $(e.target).closest('.ep_hyperlink_docs_bubble_button_delete').length ||\n    $(e.target).closest('.ep_hyperlink_docs_bubble_button_copy').length ||\n    $(e.target).closest('.full-display-link').length ||\n    $(e.target).closest('.link-title-wrapper').length ||\n    $(e.target).closest('.link-edit-form').length ||\n    $(e.target).closest('.link-text-text').length ||\n    $(e.target).closest('.link-text-hyperlink').length\n  ) {\n    // the link modal\n    return true;\n  }\n  return false;\n};\n\nconst isLinkInternal = (url) => {\n  const incomeURL = new URL(url);\n  let result = false;\n\n  // 1/ check the origin\n  if (incomeURL.origin !== location.origin) return false;\n\n\n  // 2/ origin the same but diff pad name\n  // check if the income url related to filter url\n  if (incomeURL.origin === location.origin) {\n    // does have p\n    const doesPInURL = location.pathname.split('/').indexOf('p') > 0;\n    const padName = clientVars.padId;\n    const padMainPathname = doesPInURL ? `/p/${padName}` : `/${padName}`;\n    // check if the income url pad name is the same current pad name\n    if (location.pathname.substring(0, padMainPathname.length) === padMainPathname) result = true;\n\n    // does single pad active\n    if (clientVars.ep_singlePad.active) result = true;\n  }\n\n  return result;\n};\n\nconst doesLinkHaveFilter = (url) => {\n  const result = [];\n  const padName = clientVars.padId;\n\n  const currentPathname = url.pathname.split('/');\n\n  let padNameIndex = currentPathname.indexOf(padName) + 1;\n\n  if (clientVars.ep_singlePad.active) padNameIndex = 0;\n\n  const filters = [...currentPathname].splice(padNameIndex, currentPathname.length - 1);\n\n  result.push(...filters);\n\n  return result;\n};\n\n// internal link\n// other plugin must listen for pushstate to get new data and excute they part.\nexport const internalLinkClick = function (event) {\n  event.preventDefault();\n  event.stopPropagation();\n  const href = $(this).attr('href');\n\n  if (isLinkInternal(href)) {\n    const incomeURL = new URL(href);\n    let targetPath = `${incomeURL.search}`;\n    const filters = doesLinkHaveFilter(incomeURL);\n\n    if (filters.length > 0) {\n      const doesPInURL = location.pathname.split('/').indexOf('p') > 0;\n      targetPath = doesPInURL ? '/p' : '';\n      if (!clientVars.ep_singlePad.active) targetPath += `/${clientVars.padId}`;\n      targetPath += `/${filters.join('/')}${incomeURL.search}`;\n    }\n\n    if (incomeURL.search.length === 0) targetPath = href;\n\n    // The Target is which plugin should listen more for more functionality\n    // In this example, if we find a slug filter in your URL,\n    // the target should be the filter plugin\n    const tartge = filters.length > 0 ? 'filter' : 'other';\n\n    window.history.pushState({type: 'hyperLink', href, target: tartge}, document.title, targetPath);\n    // close all link\n    hideAllLinks();\n  } else {\n    window.open(href, '_blank');\n  }\n  return false;\n};\n","import * as validUrl from './validUrl';\n/**\n * Create a link object with data filled on the given form\n * @param {jQuery} form .link-edit-form\n * @returns link object (vars text, oldText, hyperlink)\n */\nconst buildLinkFrom = (form) => {\n  const text = form.find('#hyperlink-text').val();\n  const oldText = form.find('#hyperlink-text-hidden').val();\n  const hyperlink = form.find('#hyperlink-url').val();\n\n  return {\n    text,\n    oldText,\n    hyperlink,\n  };\n};\n\nexport const hideNewLinkPopup = () => {\n  $('#newLink').removeClass('popup-show');\n\n  // force focus to be lost, so virtual keyboard is hidden on mobile devices\n  $('#newLink').find(':focus').blur();\n\n  // unmark selected text, as now there is no text being linked\n  pad.plugins.ep_full_hyperlinks.preLinkMarker.unmarkSelectedText();\n};\n\n// Callback for new link Cancel\nconst cancelNewLink = () => hideNewLinkPopup();\n\n// Callback for new link Submit\nconst submitNewLink = (callback) => {\n  const index = 0;\n  const form = $(document).find('#newLink');\n  const link = buildLinkFrom(form);\n\n  // if scheme not present, add \"https://\"\n  if (link.hyperlink.length !== 0 && !validUrl.splitUri(link.hyperlink).scheme) {\n    link.hyperlink = `https://${link.hyperlink}`;\n  }\n\n  if (link.text.length > 0 && validUrl.isUri(link.hyperlink)) {\n    form.find('#hyperlink-text, #hyperlink-url').removeClass('error');\n    hideNewLinkPopup();\n    callback(link, index);\n  } else {\n    if (link.text.length === 0) form.find('#hyperlink-text').addClass('error');\n    if (!validUrl.isUri(link.hyperlink)) form.find('#hyperlink-url').addClass('error');\n  }\n  return false;\n};\n\n/* ***** Public methods: ***** */\n\n// Insert new Link Form\nexport const insertNewLinkPopupIfDontExist = (link, callback) => {\n  $('#newLink').remove();\n  link.linkId = '';\n  const newLinkPopup = $('#newLinkTemplate').tmpl(link);\n  newLinkPopup.appendTo($('#editorcontainerbox'));\n\n  // Cancel btn\n  $('#newLink #link-cancel-btn').on('click', (e) => {\n    e.preventDefault();\n    cancelNewLink();\n  });\n\n  // Create btn // link-create-btn\n  $('#newLink #link-create-btn').on('click', (e) => submitNewLink(callback));\n\n  $(document).on('submit', 'form.link-edit-form', (e) => {\n    e.preventDefault();\n    submitNewLink(callback);\n  });\n\n  return newLinkPopup;\n};\n\nexport const showNewLinkPopup = () => {\n  if (!$('body').hasClass('mobileView')) {\n    // position below link icon\n    const offset = $('.toolbar .addLink').offset();\n    const width = ($('.toolbar .addLink').innerWidth() / 2);\n    console.log(offset, $('.toolbar .addLink').innerWidth(), width);\n    $('#newLink').css({left: offset.left + width, top: 0});\n  }\n\n  // Reset form to make sure it is all clear\n  $('#newLink').find('textarea').val('');\n  $('#newLink').find('.link-content, .to-value').removeClass('error');\n\n  // Show popup\n  $('#newLink').addClass('popup-show');\n\n  // mark selected text, so it is clear to user which text range the link is being applied to\n  pad.plugins.ep_full_hyperlinks.preLinkMarker.markSelectedText();\n\n  // focus on hyperlink input\n  setTimeout(() => $('#newLink #hyperlink-url').focus().select(), 500);\n};\n","export const MARK_CLASS = 'pre-selected-link';\n\n// we do nothing on callWithAce; actions will be handled on aceEditEvent\nconst doNothing = () => { };\nconst PreLinkMarker = function (ace) {\n  this.ace = ace;\n  const self = this;\n\n  // do nothing if this feature is not enabled\n  if (!this.highlightSelectedText()) return;\n\n  // remove any existing marks, as there is no link being added on plugin initialization\n  // (we need the timeout to let the plugin be fully initialized before starting to remove\n  // marked texts)\n  setTimeout(() => {\n    self.unmarkSelectedText();\n  }, 0);\n};\n\nexport const init = (ace) => new PreLinkMarker(ace);\n\n// Indicates if Etherpad is configured to highlight text\nPreLinkMarker.prototype.highlightSelectedText = function () {\n  return clientVars.highlightSelectedText;\n};\n\nPreLinkMarker.prototype.markSelectedText = function () {\n  // do nothing if this feature is not enabled\n  if (!this.highlightSelectedText()) return;\n\n  this.ace.callWithAce(doNothing, 'markPreSelectedTextToLink', true);\n};\n\nPreLinkMarker.prototype.unmarkSelectedText = function () {\n  // do nothing if this feature is not enabled\n  if (!this.highlightSelectedText()) return;\n\n  this.ace.callWithAce(doNothing, 'unmarkPreSelectedTextToLink', true);\n};\n\nPreLinkMarker.prototype.performNonUnduableEvent = function (eventType, callstack, action) {\n  callstack.startNewEvent('nonundoable');\n  action();\n  callstack.startNewEvent(eventType);\n};\n\nPreLinkMarker.prototype.handleMarkText = function (context) {\n  const editorInfo = context.editorInfo;\n  const rep = context.rep;\n  const callstack = context.callstack;\n\n  // first we need to unmark any existing text, otherwise we'll have 2 text ranges marked\n  this.removeMarks(editorInfo, rep, callstack);\n\n  this.addMark(editorInfo, callstack);\n};\n\nPreLinkMarker.prototype.handleUnmarkText = function (context) {\n  const editorInfo = context.editorInfo;\n  const rep = context.rep;\n  const callstack = context.callstack;\n\n  this.removeMarks(editorInfo, rep, callstack);\n};\n\nPreLinkMarker.prototype.addMark = function (editorInfo, callstack) {\n  const eventType = callstack.editEvent.eventType;\n\n  // we don't want the text marking to be undoable\n  this.performNonUnduableEvent(eventType, callstack, () => {\n    editorInfo.ace_setAttributeOnSelection(MARK_CLASS, clientVars.userId);\n  });\n};\n\nPreLinkMarker.prototype.removeMarks = function (editorInfo, rep, callstack) {\n  const eventType = callstack.editEvent.eventType;\n  const originalSelStart = rep.selStart;\n  const originalSelEnd = rep.selEnd;\n\n  // we don't want the text marking to be undoable\n  this.performNonUnduableEvent(eventType, callstack, () => {\n    // remove marked text\n    const padInner = $('iframe[name=\"ace_outer\"]').contents().find('iframe[name=\"ace_inner\"]');\n    const selector = `.${MARK_CLASS}`;\n    const repArr = editorInfo.ace_getRepFromSelector(selector, padInner);\n    // repArr is an array of reps\n    $.each(repArr, (index, rep) => {\n      editorInfo.ace_performSelectionChange(rep[0], rep[1], true);\n      editorInfo.ace_setAttributeOnSelection(MARK_CLASS, false);\n    });\n\n    // make sure selected text is back to original value\n    editorInfo.ace_performSelectionChange(originalSelStart, originalSelEnd, true);\n  });\n};\n","const randomString = (len) => {\n  const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\n  let randomstring = '';\n  len = len || 20;\n  for (let i = 0; i < len; i++) {\n    const rnum = Math.floor(Math.random() * chars.length);\n    randomstring += chars.substring(rnum, rnum + 1);\n  }\n  return randomstring;\n};\n\nexport const generateLinkId = () => `lc-${randomString(16)}`;\n\nexport const collectContentPre = (hook, context) => {\n  const link = /(?:^| )(lc-[A-Za-z0-9]*)/.exec(context.cls);\n  const fakeLink = /(?:^| )(fakelink-[A-Za-z0-9]*)/.exec(context.cls);\n\n  if (link && link[1]) {\n    context.cc.doAttrib(context.state, `link::${link[1]}`);\n  }\n\n  // a fake link is a link copied from this or another pad. To avoid conflicts\n  // with existing links, a fake linkId is used, so then we generate a new one\n  // when the link is saved\n  if (fakeLink) {\n    const mapFakeLinks = pad.plugins.ep_full_hyperlinks.getMapfakeLinks();\n    const fakeLinkId = fakeLink[1];\n    const linkId = mapFakeLinks[fakeLinkId];\n    context.cc.doAttrib(context.state, `link::${linkId}`);\n  }\n\n  return [];\n};\n","import * as shared from './shared';\n\nconst getSelectionFormated = (padInner, links) => {\n  const selection = padInner[0].contentWindow.getSelection().getRangeAt(0);\n  const selectedElements = document.createElement('div');\n\n  selectedElements.append(selection.cloneContents());\n\n  try {\n    selectedElements.querySelectorAll('.link').forEach((el) => {\n      const cls = el.getAttribute('class');\n      const classLinkId = /(?:^| )(lc-[A-Za-z0-9]*)/.exec(cls);\n      const lindId = classLinkId[1];\n\n      let newTag;\n\n      if (!links[lindId]) {\n        newTag = document.createElement('span');\n        newTag.innerHTML = el.innerHTML;\n      } else {\n        // create a tag\n        newTag = document.createElement('a');\n        newTag.innerHTML = el.innerHTML;\n        newTag.setAttribute('href', links[lindId].data.hyperlink);\n      }\n\n      // replace the current node with href node\n      const span = selectedElements.querySelector(`.${lindId}`);\n      span.replaceWith(newTag);\n    });\n  } catch (error) {\n    console.error('[ep_full_hyperlinks]: copy data has an error', error);\n  }\n\n  return selectedElements;\n};\n\nconst addTextOnClipboard = (e, padInner, removeSelection, links) => {\n  e.preventDefault();\n  const getFormatedHrefElements = getSelectionFormated(padInner, links);\n\n  e.originalEvent.clipboardData.setData('text/html', getFormatedHrefElements.outerHTML);\n\n  // if it is a cut event we have to remove the selection\n  if (removeSelection) {\n    padInner.contents()[0].execCommand('delete');\n  }\n};\n\nconst makeClipboarRedyForSaveLinks = (e, padInner) => {\n  const clipboardData = e.originalEvent.clipboardData;\n  const pastedDataHtml = clipboardData.getData('text/html');\n  const range = padInner.contents()[0].getSelection().getRangeAt(0);\n\n  if (!range) return false;\n\n  e.preventDefault();\n  const pastedHtmlHolderElemenet = document.createElement('div');\n  pastedHtmlHolderElemenet.innerHTML = pastedDataHtml;\n  const allLinksElement = pastedHtmlHolderElemenet.getElementsByTagName('a');\n  const allLinksData = {};\n\n  for (const element of allLinksElement) {\n    const tempHyperLink = element.href;\n    const tempHyperLinkText = element.innerHTML;\n    const newLinkId = shared.generateLinkId();\n    element.className = newLinkId;\n    element.id = newLinkId;\n    allLinksData[newLinkId] = {\n      data: {\n        author: 'empty',\n        linkId: newLinkId,\n        timestamp: new Date().getTime(),\n        text: tempHyperLinkText,\n        originalLinkId: newLinkId,\n        hyperlink: tempHyperLink,\n        headerId: null,\n        date: new Date(),\n        formattedDate: new Date(),\n      },\n    };\n  }\n\n  pad.plugins.ep_full_hyperlinks.saveLinkWithoutSelection(\n      clientVars.padId,\n      allLinksData\n  );\n\n  padInner\n      .contents()[0]\n      .execCommand(\n          'insertHTML',\n          false,\n          $('<div>').append($(pastedHtmlHolderElemenet).clone()).html()\n      );\n};\n\nconst saveLinks = (e, padInner) => {\n  makeClipboarRedyForSaveLinks(e, padInner);\n};\n\nexport {\n  addTextOnClipboard,\n  saveLinks,\n};\n","// TODO: replace with local storage\n// import {padcookie} from 'ep_etherpad-lite/static/js/pad_cookie'\n\nimport * as linkBoxes from './linkBoxes';\nimport * as newLink from './newLink';\nimport * as preLinkMark from './preLinkMark';\nimport * as events from './copyPasteEvents';\nimport * as shared from './shared';\n\nconst cssFiles = ['ep_full_hyperlinks/static/css/link.css'];\n\n/** **********************************************************************/\n/*                         epLinks Plugin                           */\n/** **********************************************************************/\n\n// Container\nfunction epLinks(context) {\n  this.container = null;\n  this.padOuter = null;\n  this.padInner = null;\n  this.ace = context.ace;\n\n  // Required for instances running on weird ports\n  // This probably needs some work for instances running on root or not on /p/\n  const loc = document.location;\n  const port = loc.port === '' ? (loc.protocol === 'https:' ? 443 : 80) : loc.port;\n  const url = `${loc.protocol}//${loc.hostname}:${port}/link`;\n\n  this.padId = clientVars.padId;\n  this.socket = io.connect(url, {\n    query: `padId=${this.padId}`,\n  });\n\n  this.padId = clientVars.padId;\n  this.links = [];\n  this.mapFakeLinks = [];\n  this.mapOriginalLinksId = [];\n  this.init();\n  this.preLinkMarker = preLinkMark.init(this.ace);\n}\n\n// Init Etherpad plugin link pads\nepLinks.prototype.init = async function () {\n  const self = this;\n\n  // Init prerequisite\n  this.findContainers();\n  this.insertContainers(); // Insert link containers in sidebar\n\n  const links = await this.getLinks();\n  if (!$.isEmptyObject(links)) {\n    this.setLinks(links);\n  }\n\n  this.linkListen();\n\n  // Init add push event\n  this.pushLink('add', (linkId, link) => {\n    this.setLink(linkId, link);\n  });\n\n\n  // On click link icon toolbar\n  $('.addLink').on('click touchstart', (e) => {\n    e.preventDefault(); // stops focus from being lost\n    this.displayNewLinkForm();\n  });\n\n  const submitEditeLink = async function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const $linkBox = $(this).closest('.link-container');\n    const $linkForm = $(this).closest('.link-edit-form');\n    const linkId = $linkBox.data('linkid');\n    const linkText = $linkForm.find('#hyperlink-text').val();\n    let hyperlink = $linkForm.find('#hyperlink-url').val();\n    const oldLinkText = $linkForm.find('#hyperlink-text-hidden').val();\n    $linkForm.find('.link-text-text-old').val(linkText);\n    const padOuter = $('iframe[name=\"ace_outer\"]').contents();\n    const padInner = padOuter.find('iframe[name=\"ace_inner\"]');\n    const selector = `.${linkId}`;\n    const ace = self.ace;\n    ace.callWithAce((aceTop) => {\n      const repArr = aceTop.ace_getRepFromSelector(selector, padInner);\n      if (oldLinkText !== linkText) {\n        aceTop.ace_replaceRange(repArr[0][0], repArr[0][1], linkText);\n        if (oldLinkText.length > linkText.length) {\n          repArr[0][1][1] -= oldLinkText.length - linkText.length;\n        } else if (oldLinkText.length < linkText.length) {\n          repArr[0][1][1] += linkText.length - oldLinkText.length;\n        }\n      }\n      ace.callWithAce((ace) => {\n        ace.ace_performSelectionChange(repArr[0][0], repArr[0][1], true);\n        ace.ace_setAttributeOnSelection('link', linkId);\n\n        // Note that this is the correct way of doing it, instead of there being\n        // a linkId we now flag it as \"link-deleted\"\n      });\n    }, 'editLinkedSelection', true);\n\n\n    if (!(/^http:\\/\\//.test(hyperlink)) && !(/^https:\\/\\//.test(hyperlink))) {\n      hyperlink = `http://${hyperlink}`;\n    }\n    const data = {};\n    data.linkId = linkId;\n    data.padId = clientVars.padId;\n    data.linkText = linkText;\n    data.oldLinkText = oldLinkText;\n    data.hyperlink = hyperlink;\n\n    try {\n      await self._send('updateLinkText', data);\n    } catch (err) {\n      if (err.message !== 'unauth') throw err; // Let the uncaught error handler handle it.\n      // $.gritter.add({\n      //   title: 'Error',\n      //   text: 'You cannot edit other users links!',\n      //   class_name: 'error',\n      // });\n      return;\n    }\n\n    $linkBox.removeClass('editing');\n    self.updateLinkBoxText(linkId, linkText, hyperlink);\n    linkBoxes.hideLink(linkId);\n\n    // reverting modal to show because we change it to edit mode\n    self.padOuter.find(`#show-form-${linkId}`).show();\n    self.padOuter.find(`#edit-form-${linkId}`).hide();\n    $linkBox.attr({'data-loaded': false});\n    // although the link was saved on the data base successfully, it needs\n    // to update the link variable with the new text saved\n    self.setLinkNewText(linkId, linkText, hyperlink);\n  };\n\n  // submit the edition on the text and update the link text\n  this.container.parent().on('submit', 'form.link-edit-form', submitEditeLink);\n\n  this.container.on('click', '#link-cancel-btn', function (e) {\n    e.preventDefault();\n    const linkId = $(this).closest('.link-container')[0].id;\n    self.padOuter.find(`#show-form-${linkId}`).show();\n    self.padOuter.find(`#edit-form-${linkId}`).hide();\n    linkBoxes.hideLink(linkId);\n  });\n\n  const scrollToFixEditFormInViewport = (linkId) => {\n    const $outerdoc = $('iframe[name=\"ace_outer\"]').contents().find('#outerdocbody');\n    const $outerdocHTML = $outerdoc.parent();\n    const mainHeder = $('#mainHeader').innerHeight();\n    const offsetTop = self.padOuter.find(`#edit-form-${linkId}`).closest('.link-container').offset().top - mainHeder - 25;\n    $outerdocHTML.animate({scrollTop: offsetTop});\n  };\n\n  this.container.parent().on('click', '.ep_hyperlink_docs_bubble_button_edit', function (e) {\n    const linkId = $(this).closest('.link-container')[0].id;\n    self.padOuter.find(`#show-form-${linkId}`).hide();\n    self.padOuter.find(`#edit-form-${linkId}`).show();\n    self.padOuter.find(`#edit-form-${linkId}`)\n        .find('#hyperlink-text')\n        .focus(function () {\n          this.setSelectionRange(this.value.length, this.value.length);\n        }).select();\n\n    if (clientVars.userAgent.isMobile) scrollToFixEditFormInViewport(linkId);\n  });\n\n  this.container.parent().on('click', '.ep_hyperlink_docs_bubble_button_copy', function (e) {\n    const dummy = document.createElement('input');\n    document.body.appendChild(dummy);\n    dummy.value = this.getAttribute('data-hyperlink');\n    dummy.select();\n    document.execCommand('copy');\n    document.body.removeChild(dummy);\n    $.gritter.add({\n      text: 'Link copied to clipboard',\n    });\n    const linkId = $(this).closest('.link-container')[0].id;\n    linkBoxes.hideLink(linkId);\n  });\n\n  this.container.parent().on('click', '.ep_hyperlink_docs_bubble_button_delete', async function () {\n    const linkId = $(this).closest('.link-container')[0].id;\n    self.deleteLink(linkId);\n    const padOuter = $('iframe[name=\"ace_outer\"]').contents();\n    const padInner = padOuter.find('iframe[name=\"ace_inner\"]');\n    const selector = `.${linkId}`;\n    const ace = self.ace;\n    ace.callWithAce((aceTop) => {\n      const repArr = aceTop.ace_getRepFromSelector(selector, padInner);\n      // rep is an array of reps..  I will need to iterate over each to do something meaningful..\n      $.each(repArr, (index, rep) => {\n        // I don't think we need this nested call\n        ace.callWithAce((ace) => {\n          ace.ace_performSelectionChange(rep[0], rep[1], true);\n          ace.ace_setAttributeOnSelection('link', 'link-deleted');\n          // Note that this is the correct way of doing it, instead of there being\n          // a linkId we now flag it as \"link-deleted\"\n        });\n      });\n    }, 'deleteLinkedSelection', true);\n    // dispatch event\n    try {\n      await self._send('deleteLink', {\n        padId: self.padId,\n        linkId,\n        authorId: clientVars.userId,\n      });\n    } catch (err) {\n      if (err.message !== 'unauth') throw err; // Let the uncaught error handler handle it.\n      // $.gritter.add({\n      //   title: 'Error',\n      //   text: 'You cannot delete other users links!',\n      //   class_name: 'error',\n      // });\n      return;\n    }\n  });\n\n  let hideLinkTimer;\n  this.container.on('mouseover', '.sidebar-link', (e) => {\n    // highlight link\n    clearTimeout(hideLinkTimer);\n  }).on('mouseout', '.sidebar-link', (e) => {\n    // do not hide directly the link, because sometime the mouse get out accidently\n    hideLinkTimer = setTimeout(() => {\n      const linkId = e.currentTarget.id;\n      linkBoxes.hideLink(linkId);\n    }, 3000);\n  });\n\n  this.padInner.contents().on('click', '.link', (event) => {\n    event.preventDefault();\n    clearTimeout(hideLinkTimer);\n    const linkId = self.linkIdOf(event);\n    fetch(`/pluginfw/hyperlink/${clientVars.padId}/links/${linkId}`)\n        .then((res) => res.json())\n        .then((res) => {\n          const linkObj = {...res.link, linkId};\n          linkBoxes.showLinkModal(event, linkObj, self.socket);\n        });\n  });\n\n  this.container.parent()\n      .on('click', 'a.ep_hyperlink_title', linkBoxes.internalLinkClick);\n\n\n  this.addListenersToCloseOpenedLink();\n\n  // Enable and handle cookies\n  // if (padcookie.getPref('links') === false) {\n  //   self.padOuter.find('#links').removeClass('active');\n  //   $('#options-links').attr('checked', 'unchecked');\n  //   $('#options-links').attr('checked', false);\n  // } else {\n  //   $('#options-links').attr('checked', 'checked');\n  // }\n\n  // $('#options-links').on('change', () => {\n  //   if ($('#options-links').is(':checked')) {\n  //     enableLinks();\n  //   } else {\n  //     disableLinks();\n  //   }\n  // });\n\n  // function enableLinks() {\n  //   padcookie.setPref('links', true);\n  //   self.padOuter.find('#links').addClass('active');\n  //   $('body').addClass('links-active');\n  //   $('iframe[name=\"ace_outer\"]').contents().find('body').addClass('links-active');\n  // }\n\n  // function disableLinks() {\n  //   padcookie.setPref('links', false);\n  //   self.padOuter.find('#links').removeClass('active');\n  //   $('body').removeClass('links-active');\n  //   $('iframe[name=\"ace_outer\"]').contents().find('body').removeClass('links-active');\n  // }\n\n  // Check to see if we should show already..\n  $('#options-links').trigger('change');\n\n\n  self.padInner.contents().on('copy', (e) => {\n    events.addTextOnClipboard(e, self.padInner, false, self.links);\n  });\n\n  self.padInner.contents().on('cut', (e) => {\n    events.addTextOnClipboard(e, self.padInner, true, self.links);\n  });\n\n  self.padInner.contents().on('paste', (e) => {\n    events.saveLinks(e, self.padInner);\n  });\n};\n\nepLinks.prototype.linkListen = function () {\n  const socket = this.socket;\n  socket.on('pushAddLinkInBulk', async () => {\n    const allLinks = await this.getLinks();\n    if (!$.isEmptyObject(allLinks)) {\n      // we get the Links in this format {c-123:{author:...}, c-124:{author:...}}\n      // but it's expected to be {c-123: {data: {author:...}}, c-124:{data:{author:...}}}\n      // in this.Links\n      const LinksProcessed = {};\n      for (const linkId in allLinks) {\n        if (!Object.hasOwn(allLinks, linkId)) {\n          LinksProcessed[linkId] = {};\n          LinksProcessed[linkId].data = allLinks[linkId];\n        }\n      }\n      this.Links = LinksProcessed;\n    }\n  });\n};\n\n// Insert links container on element use for linenumbers\nepLinks.prototype.findContainers = function () {\n  const padOuter = $('iframe[name=\"ace_outer\"]').contents();\n  this.padOuter = padOuter;\n  this.padInner = padOuter.find('iframe[name=\"ace_inner\"]');\n  this.outerBody = padOuter.find('#outerdocbody');\n};\n\n// set the text of the link\nepLinks.prototype.setLinkNewText = function (linkId, text, hyperlink) {\n  if (this.links[linkId]) {\n    this.links[linkId].data.text = text;\n    this.links[linkId].data.hyperlink = hyperlink;\n  } else if (this.linkReplies[linkId]) {\n    this.linkReplies[linkId].text = text;\n    this.linkReplies[linkId].hyperlink = hyperlink;\n  }\n};\n\nepLinks.prototype.addListenersToCloseOpenedLink = function () {\n  const self = this;\n\n  // we need to add listeners to the different iframes of the page\n  $(document).on('touchstart click', (e) => {\n    self.closeOpenedLinkIfNotOnSelectedElements(e);\n  });\n  this.padOuter.find('html').on('touchstart click', (e) => {\n    self.closeOpenedLinkIfNotOnSelectedElements(e);\n  });\n  this.padInner.contents().find('html').on('touchstart click', (e) => {\n    self.closeOpenedLinkIfNotOnSelectedElements(e);\n  });\n};\n\n// Close link that is opened\nepLinks.prototype.closeOpenedLink = function (e) {\n  // var linkId = this.linkIdOf(e);\n  // linkBoxes.hideLink(linkId);\n  // it was using like above but I decide check hideAllLink\n  linkBoxes.hideAllLinks();\n};\n\n// Close link if event target was outside of link or on a link icon\nepLinks.prototype.closeOpenedLinkIfNotOnSelectedElements = function (e) {\n  // Don't do anything if clicked on the allowed elements:\n  // any of the link icons\n  if (linkBoxes.shouldNotCloseLink(e)) { // a link box or the link modal\n    return;\n  }\n  // All clear, can close the link\n  this.closeOpenedLink(e);\n};\n\nepLinks.prototype.linkIdOf = function (e) {\n  const cls = e.currentTarget.classList;\n  const classLinkId = /(?:^| )(lc-[A-Za-z0-9]*)/.exec(cls);\n\n  return (classLinkId) ? classLinkId[1] : null;\n};\n\n// Insert link container in sidebar\nepLinks.prototype.insertContainers = function () {\n  const linkBoxWrapper = $('iframe[name=\"ace_outer\"]').contents()\n      .find('#outerdocbody')\n      .prepend('<div id=\"linkBoxWrapper\"></div>');\n\n  this.container = linkBoxWrapper;\n};\n\n// Set links content data\nepLinks.prototype.setLinks = function (links) {\n  for (const linkId in links) {\n    this.setLink(linkId, links[linkId]);\n  }\n};\n\n// Set link data\nepLinks.prototype.setLink = function (linkId, link) {\n  const links = this.links;\n  // link.date = timeFormat.prettyDate(link.timestamp);\n  link.formattedDate = new Date(link.timestamp).toISOString();\n\n  if (links[linkId] == null) links[linkId] = {};\n  links[linkId].data = link;\n};\n\n// set the text of the link\nepLinks.prototype.setLinkNewText = function (linkId, text, hyperlink) {\n  if (!this.links[linkId]) return;\n  this.links[linkId].data.text = text;\n  this.links[linkId].data.hyperlink = hyperlink;\n};\n\n// Get all links\nepLinks.prototype.getLinks = async function () {\n  return (await this._send('getLinks', {padId: this.padId})).links;\n};\n\nepLinks.prototype.getLinkData = function () {\n  const data = {};\n\n  // Insert link data\n  data.padId = this.padId;\n  data.link = {};\n  data.link.author = clientVars.userId;\n  data.link.name = pad.myUserInfo.name;\n  data.link.timestamp = new Date().getTime();\n\n  // If client is anonymous\n  if (data.link.name === undefined) {\n    data.link.name = clientVars.userAgent;\n  }\n\n  return data;\n};\n\n// Delete a pad link\nepLinks.prototype.deleteLink = function (linkId) {\n  $('iframe[name=\"ace_outer\"]').contents().find(`#${linkId}`).remove();\n};\n\n// start modal of new link\nepLinks.prototype.displayNewLinkForm = function () {\n  const self = this;\n  const rep = {};\n  const ace = this.ace;\n  ace.callWithAce((ace) => {\n    const saveRep = ace.ace_getRep();\n    rep.lines = saveRep.lines;\n    rep.selStart = saveRep.selStart;\n    rep.selEnd = saveRep.selEnd;\n  }, 'saveLinkedSelection', true);\n\n  const selectedText = self.getSelectedText(rep);\n\n  // we have nothing selected, do nothing\n  const noTextSelected = (selectedText.length === 0);\n  if (noTextSelected) {\n    $.gritter.add({text: 'Please first select the text to link'});\n    return;\n  }\n\n  self.createNewLinkFormIfDontExist(rep);\n\n  // Display form\n  newLink.showNewLinkPopup();\n\n  // Check if the first element selected is visible in the viewport\n  const $firstSelectedElement = self.getFirstElementSelected();\n  const firstSelectedElementInViewport = self.isElementInViewport($firstSelectedElement);\n\n  if (!firstSelectedElementInViewport) {\n    self.scrollViewportIfSelectedTextIsNotVisible($firstSelectedElement);\n  }\n\n  // add selected text to form\n  $('#newLink').find('#hyperlink-text').val(selectedText);\n  $('#newLink').find('#hyperlink-text-hidden').val(selectedText);\n};\n\nepLinks.prototype.scrollViewportIfSelectedTextIsNotVisible = function ($firstSelectedElement) {\n  // Set the top of the form to be the same Y as the target Rep\n  const y = $firstSelectedElement.offsetTop;\n  const padOuter = $('iframe[name=\"ace_outer\"]').contents();\n  padOuter.find('#outerdocbody').scrollTop(y); // Works in Chrome\n  padOuter.find('#outerdocbody').parent().scrollTop(y); // Works in Firefox\n};\n\nepLinks.prototype.isElementInViewport = function (element) {\n  const elementPosition = element.getBoundingClientRect();\n  const scrollTopFirefox = $('iframe[name=\"ace_outer\"]').contents().find('#outerdocbody').parent().scrollTop(); // works only on firefox\n  const scrolltop = $('iframe[name=\"ace_outer\"]').contents().find('#outerdocbody').scrollTop() || scrollTopFirefox;\n  // position relative to the current viewport\n  const elementPositionTopOnViewport = elementPosition.top - scrolltop;\n  const elementPositionBottomOnViewport = elementPosition.bottom - scrolltop;\n\n  const $ace_outer = $('iframe[name=\"ace_outer\"]');\n  const ace_outerHeight = $ace_outer.height();\n  const ace_outerPaddingTop = this.getIntValueOfCSSProperty($ace_outer, 'padding-top');\n\n  const clientHeight = ace_outerHeight - ace_outerPaddingTop;\n\n  const elementAboveViewportTop = elementPositionTopOnViewport < 0;\n  const elementBelowViewportBottom = elementPositionBottomOnViewport > clientHeight;\n\n  return !(elementAboveViewportTop || elementBelowViewportBottom);\n};\n\nepLinks.prototype.getIntValueOfCSSProperty = function ($element, property) {\n  const valueString = $element.css(property);\n  return parseInt(valueString) || 0;\n};\n\nepLinks.prototype.getFirstElementSelected = function () {\n  let element;\n\n  this.ace.callWithAce((ace) => {\n    const rep = ace.ace_getRep();\n    const line = rep.lines.atIndex(rep.selStart[0]);\n    const key = `#${line.key}`;\n    const padOuter = $('iframe[name=\"ace_outer\"]').contents();\n    const padInner = padOuter.find('iframe[name=\"ace_inner\"]').contents();\n    element = padInner.find(key);\n  }, 'getFirstElementSelected', true);\n\n  return element[0];\n};\n\n// Indicates if user selected some text on editor\nepLinks.prototype.checkNoTextSelected = function (rep) {\n  const noTextSelected = ((rep.selStart[0] === rep.selEnd[0]) && (rep.selStart[1] === rep.selEnd[1]));\n\n  return noTextSelected;\n};\n\n// Create form to add link\nepLinks.prototype.createNewLinkFormIfDontExist = function (rep) {\n  const data = this.getLinkData();\n  const self = this;\n\n  // If a new link box doesn't already exist, create one\n  newLink.insertNewLinkPopupIfDontExist(data, (link, index) => {\n    data.link.oldText = link.oldText;\n    data.link.text = link.text;\n    data.link.hyperlink = link.hyperlink;\n    self.saveLink(data, rep);\n  });\n};\n\n// Get a string representation of the text selected on the editor\nepLinks.prototype.getSelectedText = function (rep) {\n  // The selection representation looks like this if it starts with the fifth character in the\n  // second line and ends at (but does not include) the third character in the eighth line:\n  //     rep.selStart = [1, 4]; // 2nd line 5th char\n  //     rep.selEnd = [7, 2]; // 8th line 3rd char\n  const selectedTextLines = [];\n  const lastLine = this.getLastLine(rep.selStart[0], rep);\n  for (let lineNumber = rep.selStart[0]; lineNumber <= lastLine; ++lineNumber) {\n    const line = rep.lines.atIndex(lineNumber);\n    const selStartsAfterLine = rep.selStart[0] > lineNumber ||\n      (rep.selStart[0] === lineNumber && rep.selStart[1] >= line.text.length);\n    if (selStartsAfterLine) continue; // Nothing in this line is selected.\n    const selEndsBeforeLine = rep.selEnd[0] < lineNumber ||\n      (rep.selEnd[0] === lineNumber && rep.selEnd[1] <= 0);\n    if (selEndsBeforeLine) continue; // Nothing in this line is selected.\n    const selStartsBeforeLine = rep.selStart[0] < lineNumber || rep.selStart[1] < 0;\n    const posStart = selStartsBeforeLine ? 0 : rep.selStart[1];\n    const selEndsAfterLine = rep.selEnd[0] > lineNumber || rep.selEnd[1] > line.text.length;\n    const posEnd = selEndsAfterLine ? line.text.length : rep.selEnd[1];\n    // If the selection includes the very beginning of line, and the line has a line marker, it\n    // means the line marker was selected as well. Exclude it from the selected text.\n    selectedTextLines.push(\n        line.text.substring((posStart === 0 && this.lineHasMarker(line)) ? 1 : posStart, posEnd));\n  }\n  return selectedTextLines.join('\\n');\n};\n\nepLinks.prototype.getLastLine = function (firstLine, rep) {\n  let lastLineSelected = rep.selEnd[0];\n\n  if (lastLineSelected > firstLine) {\n    // Ignore last line if the selected text of it it is empty\n    if (this.lastLineSelectedIsEmpty(rep, lastLineSelected)) {\n      lastLineSelected--;\n    }\n  }\n  return lastLineSelected;\n};\n\nepLinks.prototype.lastLineSelectedIsEmpty = function (rep, lastLineSelected) {\n  const line = rep.lines.atIndex(lastLineSelected);\n  // when we've a line with line attribute, the first char line position\n  // in a line is 1 because of the *, otherwise is 0\n  const firstCharLinePosition = this.lineHasMarker(line) ? 1 : 0;\n  const lastColumnSelected = rep.selEnd[1];\n\n  return lastColumnSelected === firstCharLinePosition;\n};\n\nepLinks.prototype.lineHasMarker = function (line) {\n  return line.lineMarker === 1;\n};\n\nepLinks.prototype.cleanLine = function (line, lineText) {\n  const hasALineMarker = this.lineHasMarker(line);\n  if (hasALineMarker) {\n    lineText = lineText.substring(1);\n  }\n  return lineText;\n};\n\n// Save link\nepLinks.prototype.saveLink = async function (data, rep) {\n  const res = await this._send('addLink', data);\n  if (res == null) return;\n  const [linkId, link] = res;\n  link.linkId = linkId;\n\n  this.ace.callWithAce((ace) => {\n    // we should get rep again because the document might have changed..\n    rep = ace.ace_getRep();\n    ace.ace_performSelectionChange(rep.selStart, rep.selEnd, true);\n    ace.ace_setAttributeOnSelection('link', linkId);\n  }, 'insertLink', true);\n\n  this.setLink(linkId, link);\n};\n\n\n// linkData = {c-newlinkId123: data:{author:..., date:..., ...},\n//                c-newlinkId124: data:{...}}\nepLinks.prototype.saveLinkWithoutSelection = async function (padId, linkData) {\n  const data = this.buildLinks(linkData);\n  const links = await this._send('bulkAddLink', padId, data);\n  this.setLinks(links);\n};\n\nepLinks.prototype.buildLinks = function (linksData) {\n  const links = [];\n  for (const linkId in linksData) {\n    if (!Object.hasOwn(linksData, linkId)) {\n      const newLink = this.buildLink(linkId, linksData[linkId].data);\n      links.push(newLink);\n    }\n  }\n  return links;\n};\n\n\n// linkData = {c-newLinkId123: data:{author:..., date:..., ...}, ...\nepLinks.prototype.buildLink = function (linkId, linkData) {\n  const data = {};\n  data.padId = this.padId;\n  data.linkId = linkId;\n  data.text = linkData.text;\n  data.hyperlink = linkData.hyperlink;\n  data.changeTo = linkData.changeTo;\n  data.changeFrom = linkData.changeFrom;\n  data.name = linkData.name;\n  data.timestamp = parseInt(linkData.timestamp);\n\n  return data;\n};\n\n\nepLinks.prototype._send = async function (type, ...args) {\n  return await new Promise((resolve, reject) => {\n    this.socket.emit(type, ...args, (errj, val) => {\n      if (errj != null) return reject(Object.assign(new Error(errj.message), {name: errj.name}));\n      resolve(val);\n    });\n  });\n};\n\nepLinks.prototype.getMapfakeLinks = function () {\n  return this.mapFakeLinks;\n};\n\nepLinks.prototype.findLinkText = function ($linkBox) {\n  return $linkBox.find('.compact-display-content .link-text-text, .full-display-link .link-title-wrapper .link-text-text');\n};\n\nepLinks.prototype.findHyperLinkText = function ($linkBox) {\n  return $linkBox.find('.compact-display-content .link-text-hyperlink, .full-display-link .link-title-wrapper .link-text-hyperlink');\n};\n\nepLinks.prototype.updateLinkBoxText = function (linkId, linkText, hyperlink) {\n  const $link = this.container.parent().find(`[data-linkid='${linkId}']`);\n  $link.attr('data-hyperlink', hyperlink);\n\n  const textBox = this.findLinkText($link);\n  // textBox.text(linkText)\n  textBox.val(linkText);\n\n  const linkBox = this.findHyperLinkText($link);\n  // linkBox.text(hyperlink)\n  linkBox.val(hyperlink);\n};\n\nepLinks.prototype.showChangeAsAccepted = function (linkId) {\n  const self = this;\n\n  // Get the link\n  const link = this.container.parent().find(`[data-linkid='${linkId}']`);\n  // Revert other link that have already been accepted\n  link.closest('.sidebar-link')\n      .find('.link-container.change-accepted').addBack('.change-accepted')\n      .each(function () {\n        $(this).removeClass('change-accepted');\n        const data = {linkId: $(this).attr('data-linkid'), padId: self.padId};\n        self._send('revertChange', data);\n      });\n\n  // this link get accepted\n  link.addClass('change-accepted');\n};\n\n\nepLinks.prototype.showChangeAsReverted = function (linkId) {\n  const self = this;\n  // Get the link\n  const link = self.container.parent().find(`[data-linkid='${linkId}']`);\n  link.removeClass('change-accepted');\n};\n\n// Push link from collaborators\nepLinks.prototype.pushLink = function (eventType, callback) {\n  const socket = this.socket;\n  const self = this;\n\n  socket.on('textLinkUpdated', (linkId, linkText, hyperlink) => {\n    self.updateLinkBoxText(linkId, linkText, hyperlink);\n  });\n\n  socket.on('linkDeleted', (linkId) => {\n    self.deleteLink(linkId);\n  });\n\n  socket.on('changeAccepted', (linkId) => {\n    self.showChangeAsAccepted(linkId);\n  });\n\n  socket.on('changeReverted', (linkId) => {\n    self.showChangeAsReverted(linkId);\n  });\n\n  // On collaborator add a link in the current pad\n  if (eventType === 'add') {\n    socket.on('pushAddLink', (linkId, link) => {\n      callback(linkId, link);\n    });\n  }\n};\n\n/** **********************************************************************/\n/*                           Etherpad Hooks                             */\n/** **********************************************************************/\n\nconst hooks = {\n\n  // Init pad links\n  postAceInit: (hook, context) => {\n    if (!pad.plugins) pad.plugins = {};\n    const Links = new epLinks(context);\n    pad.plugins.ep_full_hyperlinks = Links;\n\n    if (!$('#editorcontainerbox').hasClass('flex-layout')) {\n      $.gritter.add({\n        title: 'Error',\n        text: 'ep_full_hyperlinks: Please upgrade to etherpad 1.8.3 for this plugin to work correctly',\n        sticky: true,\n        class_name: 'error',\n      });\n    }\n    return [];\n  },\n\n  aceEditEvent: (hook, context) => {\n    if (!pad.plugins) pad.plugins = {};\n    // first check if some text is being marked/unmarked to add link to it\n    const eventType = context.callstack.editEvent.eventType;\n\n    if (eventType === 'setup' || eventType === 'setBaseText' || eventType === 'importText') return;\n\n    if (eventType === 'unmarkPreSelectedTextToLink') {\n      pad.plugins.ep_full_hyperlinks.preLinkMarker.handleUnmarkText(context);\n    } else if (eventType === 'markPreSelectedTextToLink') {\n      pad.plugins.ep_full_hyperlinks.preLinkMarker.handleMarkText(context);\n    }\n\n    return [];\n  },\n\n  // Insert links classes\n  aceAttribsToClasses: (hook, context, cb) => {\n    if (context.key === 'link' && context.value !== 'link-deleted') {\n      return ['link', context.value];\n    }\n    // only read marks made by current user\n    if (context.key === preLinkMark.MARK_CLASS && context.value === clientVars.userId) {\n      return [preLinkMark.MARK_CLASS, context.value];\n    }\n    return [];\n  },\n\n  aceEditorCSS: (hookName, context, cb) => cssFiles,\n};\n\n// Given a CSS selector and a target element (in this case pad inner)\n// return the rep as an array of array of tuples IE [[[0,1],[0,2]], [[1,3],[1,5]]]\n// We have to return an array of a array of tuples because there can be multiple reps\n// For a given selector\n// A more sane data structure might be an object such as..\n/*\n0:{\n  xStart: 0,\n  xEnd: 1,\n  yStart: 0,\n  yEnd: 1\n},\n1:...\n*/\n// Alas we follow the Etherpad convention of using tuples here.\nfunction getRepFromSelector(selector, container) {\n  const attributeManager = this.documentAttributeManager;\n\n  const repArr = [];\n\n  // first find the element\n  const elements = container.contents().find(selector);\n  // One might expect this to be a rep for the entire document\n  // However what we actually need to do is find each selection that includes\n  // this link and remove it.  This is because content can be pasted\n  // Mid link which would mean a remove selection could have unexpected consequences\n\n  $.each(elements, (index, span) => {\n    // create a rep array container we can push to..\n    const rep = [[], []];\n\n    // span not be the div so we have to go to parents until we find a div\n    const parentDiv = $(span).closest('div');\n    // line Number is obviously relative to entire document\n    // So find out how many elements before in this parent?\n    const lineNumber = $(parentDiv).prevAll('div').length;\n    // We can set beginning of rep Y (lineNumber)\n    rep[0][0] = lineNumber;\n\n    // We can also update the end rep Y\n    rep[1][0] = lineNumber;\n\n    // Given the link span, how many characters are before it?\n\n    // All we need to know is the number of characters before .foo\n    /*\n\n    <div id=\"boo\">\n      hello\n      <span class='nope'>\n        world\n      </span>\n      are you\n      <span class='foo'>\n        here?\n      </span>\n    </div>\n\n    */\n    // In the example before the correct number would be 21\n    // I guess we could do prevAll each length?\n    // If there are no spans before we get 0, simples!\n    // Note that this only works if spans are being used, which imho\n    // Is the correct container however if block elements are registered\n    // It's plausable that attributes are not maintained :(\n    let leftOffset = 0;\n\n    // If the line has a lineAttribute then leftOffset should be +1\n    // Get each line Attribute on this line..\n    let hasLineAttribute = false;\n    const attrArr = attributeManager.getAttributesOnLine(lineNumber);\n    $.each(attrArr, (attrK, value) => {\n      if (value[0] === 'lmkr') hasLineAttribute = true;\n    });\n    if (hasLineAttribute) leftOffset++;\n\n    $(span).prevAll('span').each(function () {\n      const spanOffset = $(this).text().length;\n      leftOffset += spanOffset;\n    });\n    rep[0][1] = leftOffset;\n\n    // All we need to know is span text length and it's left offset in chars\n    // const spanLength = $(span).text().length;\n\n    rep[1][1] = rep[0][1] + $(span).text().length; // Easy!\n    repArr.push(rep);\n  });\n  return repArr;\n}\n// Once ace is initialized, we set ace_doInsertHeading and bind it to the context\nexport const aceInitialized = (hook, context) => {\n  const editorInfo = context.editorInfo;\n  editorInfo.ace_getRepFromSelector = getRepFromSelector.bind(context);\n};\n\nexport const acePostWriteDomLineHTML = (name, context) => {\n  const hasHyperlink = $(context.node).find('a');\n  if (hasHyperlink.length > 0) {\n    hasHyperlink.each(function () {\n      $(this).on('click', linkBoxes.internalLinkClick);\n    });\n  }\n};\n\nexport const aceEditorCSS = hooks.aceEditorCSS;\nexport const postAceInit = hooks.postAceInit;\nexport const aceAttribsToClasses = hooks.aceAttribsToClasses;\nexport const aceEditEvent = hooks.aceEditEvent;\nexport const collectContentPre = shared.collectContentPre;\n"],"names":["Object","defineProperty","exports","value","splitUri","link","splitted","match","uri","scheme","authority","path","query","fragment","isUri","test","out","length","toLowerCase","padOuter","getPadOuter","$","contents","getLinksContainer","find","hideLink","linkId","hide","show","hideAllLinks","setPositionModal","e","linkModal","padInner","clickCoords","posx","posy","window","event","pageX","pageY","clientX","clientY","document","body","scrollLeft","documentElement","scrollTop","x","y","getPosition","clickCoordsX","clickCoordsY","modalWith","innerWidth","modalHeight","outerHeight","windowWidth","windowHeight","windoPaddingTop","parseInt","css","linkElementTop","target","offset","top","linkElementHeight","newL","left","newT","hasClass","offsetHeight","transform","width","internalLinkClick","preventDefault","stopPropagation","href","this","attr","url","incomeURL","URL","result","origin","location","doesPInURL","pathname","split","indexOf","padName","clientVars","padId","padMainPathname","substring","ep_singlePad","active","isLinkInternal","targetPath","search","filters","currentPathname","padNameIndex","splice","push","doesLinkHaveFilter","join","tartge","history","pushState","type","title","open","hideNewLinkPopup","removeClass","blur","pad","plugins","ep_full_hyperlinks","preLinkMarker","unmarkSelectedText","submitNewLink","callback","form","text","val","oldText","hyperlink","buildLinkFrom","validUrl.splitUri","validUrl.isUri","addClass","insertNewLinkPopupIfDontExist","remove","newLinkPopup","tmpl","appendTo","on","MARK_CLASS","doNothing","PreLinkMarker","ace","self","highlightSelectedText","setTimeout","prototype","markSelectedText","callWithAce","performNonUnduableEvent","eventType","callstack","action","startNewEvent","handleMarkText","context","editorInfo","rep","removeMarks","addMark","handleUnmarkText","editEvent","ace_setAttributeOnSelection","userId","originalSelStart","selStart","originalSelEnd","selEnd","selector","repArr","ace_getRepFromSelector","each","index","ace_performSelectionChange","generateLinkId","len","chars","randomstring","i","rnum","Math","floor","random","randomString","addTextOnClipboard","removeSelection","links","getFormatedHrefElements","selection","contentWindow","getSelection","getRangeAt","selectedElements","createElement","append","cloneContents","querySelectorAll","forEach","el","cls","getAttribute","lindId","exec","newTag","innerHTML","setAttribute","data","querySelector","replaceWith","error","console","getSelectionFormated","originalEvent","clipboardData","setData","outerHTML","execCommand","saveLinks","pastedDataHtml","getData","pastedHtmlHolderElemenet","allLinksElement","getElementsByTagName","allLinksData","element","tempHyperLink","tempHyperLinkText","newLinkId","shared.generateLinkId","className","id","author","timestamp","Date","getTime","originalLinkId","headerId","date","formattedDate","saveLinkWithoutSelection","clone","html","makeClipboarRedyForSaveLinks","cssFiles","epLinks","container","loc","port","protocol","hostname","socket","io","connect","mapFakeLinks","mapOriginalLinksId","init","async","findContainers","insertContainers","getLinks","isEmptyObject","setLinks","linkListen","pushLink","setLink","displayNewLinkForm","parent","$linkBox","closest","$linkForm","linkText","oldLinkText","aceTop","ace_replaceRange","_send","err","message","updateLinkBoxText","linkBoxes.hideLink","setLinkNewText","hideLinkTimer","focus","setSelectionRange","select","userAgent","isMobile","$outerdocHTML","mainHeder","innerHeight","offsetTop","animate","scrollToFixEditFormInViewport","dummy","appendChild","removeChild","gritter","add","deleteLink","authorId","clearTimeout","currentTarget","linkIdOf","fetch","then","res","json","linkObj","linkModalAppended","loaded","dividedUrl","ep_hyperlink_img","ep_hyperlink_title","card_loading_hyperlink","ep_hyperlink_description","changeMetaView","image","fadeOut","fadeIn","replace","metaResolverCallBack","metadata","editedHyperlink","last","emit","linkBoxes.showLinkModal","linkBoxes.internalLinkClick","addListenersToCloseOpenedLink","trigger","events.addTextOnClipboard","events.saveLinks","allLinks","LinksProcessed","hasOwn","Links","outerBody","linkReplies","closeOpenedLinkIfNotOnSelectedElements","closeOpenedLink","linkBoxes.hideAllLinks","linkBoxes.shouldNotCloseLink","classList","classLinkId","linkBoxWrapper","prepend","toISOString","getLinkData","name","myUserInfo","undefined","saveRep","ace_getRep","lines","selectedText","getSelectedText","createNewLinkFormIfDontExist","log","newLink.showNewLinkPopup","$firstSelectedElement","getFirstElementSelected","isElementInViewport","scrollViewportIfSelectedTextIsNotVisible","elementPosition","getBoundingClientRect","scrollTopFirefox","scrolltop","elementPositionTopOnViewport","elementPositionBottomOnViewport","bottom","$ace_outer","ace_outerHeight","height","ace_outerPaddingTop","getIntValueOfCSSProperty","$element","property","valueString","key","atIndex","checkNoTextSelected","newLink.insertNewLinkPopupIfDontExist","saveLink","selectedTextLines","lastLine","getLastLine","lineNumber","line","posStart","posEnd","lineHasMarker","firstLine","lastLineSelected","lastLineSelectedIsEmpty","firstCharLinePosition","lineMarker","cleanLine","lineText","linkData","buildLinks","linksData","newLink","buildLink","changeTo","changeFrom","args","Promise","resolve","reject","errj","assign","Error","getMapfakeLinks","findLinkText","findHyperLinkText","$link","showChangeAsAccepted","addBack","showChangeAsReverted","getRepFromSelector","attributeManager","documentAttributeManager","elements","span","parentDiv","prevAll","leftOffset","hasLineAttribute","attrArr","getAttributesOnLine","attrK","spanOffset","aceEditorCSS","hookName","cb","postAceInit","hook","sticky","class_name","aceAttribsToClasses","preLinkMark.MARK_CLASS","aceEditEvent","collectContentPre","fakeLink","cc","doAttrib","state","shared.collectContentPre","bind","hasHyperlink","node"],"mappings":"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"}