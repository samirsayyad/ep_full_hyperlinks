exports.moduleList=(()=>{const t=require("ep_etherpad-lite/static/js/pad_utils").randomString,e=require("ep_etherpad-lite/static/js/underscore"),n=(i=function(t,n){let i={};return e.each(n,n=>{i=e.extend(s(t,n),i)}),i},s=function(t,n){const i={};return e.each(t,(t,e)=>{t.linkId===n&&(i[e]=t)}),i},o=function(t,n){const i=function(t){const n={};return e.each(t,(t,e)=>{const i=t.data.originalLinkId;n[i]=e}),n}(t);return e.each(i,(t,e)=>{$(n).find("."+e).removeClass(e).addClass(t)}),d(n)},a=function(t,n){const i={},s=r(t);return e.each(s,t=>{const e=l(),s=n[t];s.data.originalLinkId=t,i[e]=s}),i},l=function(){return"fakelink-"+t(16)},r=function(t){const n=$(t).find("span"),i=[];return e.each(n,t=>{const e=$(t).attr("class"),n=/(?:^| )(lc-[A-Za-z0-9]*)/.exec(e),s=!!n&&n[1];s&&i.push(s)}),e.uniq(i)},c=function(t){const e=t.cloneContents(),n=document.createElement("div");return $(n).html(e)},d=function(t){return $(t).html()},p=function(t){const e=d(t);return x(e)===$(t).text()},u=function(t,e,n){const i=h(t,n),s=f(i,e);return $.parseHTML(`<div>${s}</div>`)},f=function(t,e){const n=e.commonAncestorContainer.parentNode,i=g(n);return i&&(t=k(i)+t+m(i)),t},h=function(t,e){return`<span class="link ${e}">${t.slice(0,-1)}</span><span class="link ${e}">${t.slice(-1)}</span>`},k=function(t){let e="";return t.forEach(t=>{e+=`<${t}>`}),e},m=function(t){let e="";return(t=t.reverse()).forEach(t=>{e+=`</${t}>`}),e},g=function(t){const e=[];let n;if($(t)[0].hasOwnProperty("localName"))for(;"span"!==$(t)[0].localName;){const i=$(t).prop("outerHTML"),s=/<(b|i|u|s)>/.exec(i);n=s?s[1]:"",e.push(n),t=$(t).parent()}return e},y=function(t){const n={},i=clientVars.padId,s=pad.plugins.ep_full_hyperlinks.mapOriginalLinksId,o=pad.plugins.ep_full_hyperlinks.mapFakeLinks;e.each(t,(t,e)=>{v(t,e);const i=G.generateLinkId();o[e]=i;const a=t.data.originalLinkId;s[a]=i,n[i]=t}),pad.plugins.ep_full_hyperlinks.saveLinkWithoutSelection(i,n)},_=function(t){const n={},i=clientVars.padId,s=pad.plugins.ep_full_hyperlinks.mapOriginalLinksId;e.each(t,(t,e)=>{const i=t.linkId;t.linkId=s[i],n[e]=t}),pad.plugins.ep_full_hyperlinks.saveLinkReplies(i,n)},v=function(t,e){const n={};return n.padId=clientVars.padId,n.link=t.data,n.link.linkId=e,n},x=function(t){const e=document.createElement("div");return e.innerHTML=t,0===e.childNodes.length?"":e.childNodes[0].nodeValue},w=function(t,e,n,i){let s=!1;for(let o=t;o<=e&&!s;o++){const a=L(o,n,t),l=b(o,n,e);I(o,a,l,i)&&(s=!0)}return s},L=function(t,e,n){return t!==n?0:e.selStart[1]},b=function(t,e,n){let i;return i=t!==n?C(t,e):e.selEnd[1]-1,i},I=function(t,n,i,s){let o=!1;for(let a=n;a<=i&&!o;a++)void 0!==e.object(s.getAttributesOnPosition(t,a)).link&&(o=!0);return o},T=function(t,e){return t!==e},C=function(t,e){const n=t+1,i=e.lines.offsetOfIndex(t);return e.lines.offsetOfIndex(n)-i-1},{addTextOnClipboard:function(t,e,n,s,l,d){let f,h;if(e.callWithAce(t=>{f=t.ace_getLinkIdOnFirstPositionSelected(),h=t.ace_hasLinkOnSelection()}),h){let e;const h=n.contents()[0].getSelection().getRangeAt(0),k=c(h);let m=k;if(p(k)){const t=k[0].textContent;m=u(t,h,f)}const g=r(m);e=a(m,l);const y=o(e,m);e=JSON.stringify(e);let _=i(d,g);_=JSON.stringify(_),t.originalEvent.clipboardData.setData("text/objectReply",_),t.originalEvent.clipboardData.setData("text/objectLink",e),t.originalEvent.clipboardData.setData("text/html",y),t.preventDefault(),s&&n.contents()[0].execCommand("delete")}},saveLinksAndReplies:function(t){let e=t.originalEvent.clipboardData.getData("text/objectLink"),n=t.originalEvent.clipboardData.getData("text/objectReply");e&&n&&(e=JSON.parse(e),n=JSON.parse(n),y(e),_(n))},getLinkIdOnFirstPositionSelected:function(){const t=this.documentAttributeManager,n=this.rep;return e.object(t.getAttributesOnPosition(n.selStart[0],n.selStart[1])).link},hasLinkOnSelection:function(){let t;const e=this.documentAttributeManager,n=this.rep,i=n.selStart[0],s=n.selStart[1],o=n.selEnd[1],a=n.selEnd[0];return t=T(i,a)?w(i,a,n,e):I(i,s,o,e),t}});var i,s,o,a,l,r,c,d,p,u,f,h,k,m,g,y,_,v,x,w,L,b,I,T,C;const S=(()=>{let t;const e=function(){return t=t||$('iframe[name="ace_outer"]').contents(),t},n=()=>e().find("#links");var i=function(i,s,o,a,l){const r=n(),c=r.find("#"+i);var d,p=$('iframe[name="ace_outer"]').contents().find('iframe[name="ace_inner"]');if(r.find(".sidebar-link").each((function(){p.contents().find("head .link-style").remove(),$(this).attr("data-linkid")!=i&&$(this).hasClass("hyperlink-display")&&($(this).removeClass("hyperlink-display"),t.find("#edit-form-"+$(this).attr("data-linkid")).hide(),t.find("#show-form-"+$(this).attr("data-linkid")).show(),$(this).css({top:parseInt($(this).css("top").split("px")[0])-35+"px"}),$(this).css({top:c.attr("data-basetop")+"px"}))})),!c.hasClass("hyperlink-display")){c.css({width:"324px"});const n=c.attr("data-loaded"),i=e().find('iframe[name="ace_inner"]');let o=s.clientX;o+=i.offset().left;let r=$(s.target).offset().top;if(r+=parseInt(i.css("padding-top").split("px")[0]),r+=parseInt(t.find("#outerdocbody").css("padding-top").split("px")[0]),c.css({left:parseInt(o)+"px"}),c.css({top:parseInt(r)+35+"px"}),c.addClass("hyperlink-display"),"true"!=n){let t=c.attr("data-hyperlink");const e=c.find("#ep_hyperlink_title");e.text(t);const n=c.find("#ep_hyperlink_img"),i=c.find("#ep_hyperlink_description");i.text("");const s=c.find("#card_loading_hyperlink");if(n.hide(),e.show(),s.show(),/^http:\/\//.test(t)||/^https:\/\//.test(t)||(t="https://"+t),d=t,!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(d))return n.attr("src","../static/plugins/ep_full_hyperlinks/static/dist/img/nometa.png"),n.on("load",()=>{s.fadeOut(500,()=>{n.fadeIn(),i.text(t.replace(/^(?:https?:\/\/)?(?:www\.)?/i,"").split("/")[0]),c.attr({"data-loaded":!0})})}),!1;const o=function(r){if(e.attr("href",t),r.metadata.image&&r.metadata.title)n.attr("src",r.metadata.image),n.on("load",()=>{s.fadeOut(500,()=>{n.fadeIn(),e.text(r.metadata.title),i.text(r.metadata.url.replace(/^(?:https?:\/\/)?(?:www\.)?/i,"").split("/")[0]),c.attr({"data-loaded":!0})})});else{const e=new URL(t);t="https://"+e.hostname,!0!==r.last?a.emit("metaResolver",{padId:l,hyperlink:t,last:!0},o):(n.attr("src","../static/plugins/ep_full_hyperlinks/static/dist/img/nometa.png"),n.on("load",()=>{s.fadeOut(500,()=>{n.fadeIn(),i.text(t.replace(/^(?:https?:\/\/)?(?:www\.)?/i,"").split("/")[0]),c.attr({"data-loaded":!0})})}))}};a.emit("metaResolver",{padId:l,hyperlink:t,last:!1},o)}}(p=$('iframe[name="ace_outer"]').contents().find('iframe[name="ace_inner"]')).contents().find("head").append(`<style class='link-style'>.${i}{ color: #a7680c !important }</style>`)};return{showLink:function(t,e){n().find("#"+t).show(),i(t,e)},hideLink:function(i,s){const o=n().find("#"+i);o.hasClass("hyperlink-display")&&(o.css({top:o.attr("data-basetop")+"px"}),o.removeClass("hyperlink-display"),o.css({width:"324px"}),t.find("#edit-form-"+i).hide(),t.find("#show-form-"+i).show());$('iframe[name="ace_outer"]').contents().find('iframe[name="ace_inner"]').contents().find("head .link-style").remove(),e().find(".link-modal").removeClass("popup-show")},hideAllLinks:function(){const e=n(),i=$('iframe[name="ace_outer"]').contents().find('iframe[name="ace_inner"]');e.find(".sidebar-link").each((function(){i.contents().find("head .link-style").remove(),$(this).hasClass("hyperlink-display")&&($(this).removeClass("hyperlink-display"),$(this).css({width:"324px"}),t.find("#edit-form-"+$(this).attr("data-linkid")).hide(),t.find("#show-form-"+$(this).attr("data-linkid")).show(),$(this).css({top:$(this).attr("data-basetop")+"px"}))}))},highlightLink:i,adjustTopOf:function(t,n){const i=e().find("#"+t);return i.css("top",n+"px"),i.attr("data-basetop",n),i},isOnTop:function(t,n){const i=n+"px";return e().find("#"+t).css("top")===i},shouldNotCloseLink:function(t){return!!($(t.target).closest(".link").length||$(t.target).closest(".link-modal").length||$(t.target).closest(".ep_hyperlink_docs_bubble_button_edit").length||$(t.target).closest(".ep_hyperlink_docs_bubble_button_delete").length||$(t.target).closest(".ep_hyperlink_docs_bubble_button_copy").length||$(t.target).closest(".full-display-link").length||$(t.target).closest(".link-title-wrapper").length||$(t.target).closest(".link-edit-form").length||$(t.target).closest(".link-text-text").length||$(t.target).closest(".link-text-hyperlink").length)}}})(),O=(z=function(){return clientVars.displayLinkAsIcon},N=function(){return A=A||$('iframe[name="ace_outer"]').contents()},M=function(){return E=E||N().find('iframe[name="ace_inner"]').contents()},D=function(t){const e=N().find("#linkIcons"),n="icon-at-"+t;let i=e.find("."+n);return 0===i.length&&(e.append(`<div class="link-icon-line ${n}"></div>`),i=e.find("."+n),i.css("top",t+"px")),i},R=function(t){return t.currentTarget.getAttribute("data-linkid")},P=function(t){M().find("head .link-style").remove()},j=function(t){t.toggleClass("active").toggleClass("inactive")},V=function(){N().find("#linkIcons").on("mouseover",".link-icon",t=>{P(),function(t){M().find("head").append(`<style class='link-style'>.${t}{ color: #a7680c !important }</style>`)}(R(t))}).on("mouseout",".link-icon",t=>{R(t),P()}).on("click",".link-icon.active",(function(t){j($(this));const e=R(t);S.hideLink(e,!0)})).on("click",".link-icon.inactive",(function(t){S.hideAllLinks();const e=N().find("#linkIcons").find(".link-icon.active");j(e),j($(this));const n=R(t);S.highlightLink(n,t)}))},F=function(t){if(H(t)||S.shouldNotCloseLink(t))return;const e=U();if(e){j($(e));const t=e.getAttribute("data-linkid");S.hideLink(t,!0)}},U=function(){return N().find("#linkIcons .link-icon.active").get(0)},{insertContainer:function(){z()&&(N().find("#sidediv").after('<div id="linkIcons"></div>'),N().find("#links").addClass("with-icons"),V(),$(document).on("touchstart click",t=>{F(t)}),N().find("html").on("touchstart click",t=>{F(t)}),M().find("html").on("touchstart click",t=>{F(t)}))},addIcon:function(t,e){if(!z())return;const n=M().find(".link."+t).get(0).offsetTop,i=D(n);$("#linkIconTemplate").tmpl(e).appendTo(i)},hideIcons:function(){z()&&N().find("#linkIcons").children().children().each((function(){$(this).hide()}))},adjustTopOf:function(t,e){if(!z())return;const n=N().find("#icon-"+t),i=D(e);return i!=n.parent()&&n.appendTo(i),n.show(),n},isLinkOpenedByClickOnIcon:function(){return!!z()&&0!==N().find("#linkIcons").find(".link-icon.active").length},linkHasReply:function(t){z()&&N().find("#linkIcons").find("#icon-"+t).addClass("with-reply")},shouldShow:function(t){let e=!1;return z()?t.hasClass("mouseover")&&(e=!0):e=!0,e},shouldNotCloseLink:H=function(t){return 0!==$(t.target).closest(".link-icon").length}});var A,E,z,N,M,D,R,P,j,V,F,U,H;const J={localize:function(t){html10n.translateElement(html10n.translations,t.get(0))}},W=(q=function(t){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(t)},{localizenewLinkPopup:K=function(){const t=$("#newLink");0!==t.length&&J.localize(t)},insertNewLinkPopupIfDontExist:function(t,e){$("#newLink").remove();var n=$("#newLink");return t.linkId="",(n=$("#newLinkTemplate").tmpl(t)).appendTo($("#editorcontainerbox")),K(),$("#newLink").find(".suggestion-checkbox").change((function(){$("#newLink").find(".suggestion").toggle($(this).is(":checked"))})),n.find("#link-reset").on("click",()=>{Z()}),$("#newLink").on("submit",t=>(t.preventDefault(),function(t){const e=$("#newLink"),n=function(t){const e=t.find("#hyperlink-text").val(),n=t.find("#hyperlink-text-hidden").val();let i=t.find("#hyperlink-url").val();const s=t.find(".from-value").text(),o=t.find(".to-value").val()||null,a={};return/^http:\/\//.test(i)||/^https:\/\//.test(i)||(i="https://"+i),a.text=e,a.oldText=n,a.hyperlink=i,o&&(a.changeFrom=s,a.changeTo=o),a}(e);return(n.text.length>0||n.changeTo&&n.changeTo.length>0)&&q(n.hyperlink)?(e.find(".link-content, .to-value").removeClass("error"),Z(),t(n,0)):(0==n.text.length&&e.find(".link-content").addClass("error"),q(n.hyperlink)||e.find("#hyperlink-url").addClass("error"),n.changeTo&&0==n.changeTo.length&&e.find(".to-value").addClass("error")),!1}(e))),n},showNewLinkPopup:function(){$("#newLink").css("left",$(".toolbar .addLink").offset().left),$("#newLink").find(".suggestion-checkbox").prop("checked",!1).trigger("change"),$("#newLink").find("textarea").val(""),$("#newLink").find(".link-content, .to-value").removeClass("error"),$("#newLink").addClass("popup-show"),pad.plugins.ep_full_hyperlinks.preLinkMarker.markSelectedText(),setTimeout(()=>{$("#newLink").find(".link-content").focus().select()},500)},hideNewLinkPopup:Z=function(){$("#newLink").removeClass("popup-show"),$("#newLink").find(":focus").blur(),pad.plugins.ep_full_hyperlinks.preLinkMarker.unmarkSelectedText()}});var q,K,Z;const B=(()=>{const t="pre-selected-link";var e=function(t){this.ace=t;const e=this;this.highlightSelectedText()&&setTimeout(()=>{e.unmarkSelectedText()},0)};e.prototype.highlightSelectedText=function(){return clientVars.highlightSelectedText},e.prototype.markSelectedText=function(){this.highlightSelectedText()&&this.ace.callWithAce(n,"markPreSelectedTextToLink",!0)},e.prototype.unmarkSelectedText=function(){this.highlightSelectedText()&&this.ace.callWithAce(n,"unmarkPreSelectedTextToLink",!0)},e.prototype.performNonUnduableEvent=function(t,e,n){e.startNewEvent("nonundoable"),n(),e.startNewEvent(t)},e.prototype.handleMarkText=function(t){const e=t.editorInfo,n=t.rep,i=t.callstack;this.removeMarks(e,n,i),this.addMark(e,i)},e.prototype.handleUnmarkText=function(t){const e=t.editorInfo,n=t.rep,i=t.callstack;this.removeMarks(e,n,i)},e.prototype.addMark=function(e,n){const i=n.editEvent.eventType;this.performNonUnduableEvent(i,n,()=>{e.ace_setAttributeOnSelection(t,clientVars.userId)})},e.prototype.removeMarks=function(e,n,i){const s=i.editEvent.eventType,o=n.selStart,a=n.selEnd;this.performNonUnduableEvent(s,i,()=>{const n=$('iframe[name="ace_outer"]').contents().find('iframe[name="ace_inner"]'),i=e.ace_getRepFromSelector(".pre-selected-link",n);$.each(i,(n,i)=>{e.ace_performSelectionChange(i[0],i[1],!0),e.ace_setAttributeOnSelection(t,!1)}),e.ace_performSelectionChange(o,a,!0)})};var n=function(){};return{MARK_CLASS:t,init:function(t){return new e(t)}}})(),X=(()=>{var t="undefined"!=typeof html10n;l10nKeys={seconds:"ep_full_hyperlinks.time.seconds","1 minute ago":"ep_full_hyperlinks.time.one_minute",minutes:"ep_full_hyperlinks.time.minutes","1 hour ago":"ep_full_hyperlinks.time.one_hour",hours:"ep_full_hyperlinks.time.hours",yesterday:"ep_full_hyperlinks.time.one_day",days:"ep_full_hyperlinks.time.days","last week":"ep_full_hyperlinks.time.one_week",weeks:"ep_full_hyperlinks.time.weeks","last month":"ep_full_hyperlinks.time.one_month",months:"ep_full_hyperlinks.time.months","last year":"ep_full_hyperlinks.time.one_year",years:"ep_full_hyperlinks.time.years","last century":"ep_full_hyperlinks.time.one_century",centuries:"ep_full_hyperlinks.time.centuries"};var e=[[60,"seconds",1],[120,"1 minute ago","1 minute from now"],[3600,"minutes",60],[7200,"1 hour ago","1 hour from now"],[86400,"hours",3600],[172800,"yesterday","tomorrow"],[604800,"days",86400],[1209600,"last week","next week"],[2419200,"weeks",604800],[4838400,"last month","next month"],[29030400,"months",2419200],[58060800,"last year","next year"],[290304e4,"years",29030400],[580608e4,"last century","next century"],[580608e5,"centuries",290304e4]];return{prettyDate:function(n){let i=(new Date-new Date(n))/1e3,s="ago",o=1,a=".past";i<0&&(i=Math.abs(i),s="from now",a=".future",o=2);let l,r=0;for(;l=e[r++];)if(i<l[0]){const e=Math.floor(i/l[2]);var c;if(t){const t=l10nKeys[l[1]]+a;c=html10n.get(t,{count:e})}return void 0===c&&(c="string"==typeof l[2]?l[o]:`${e} ${l[1]} ${s}`),c}return n}}})(),G={collectContentPre:(t,e)=>{const n=/(?:^| )(lc-[A-Za-z0-9]*)/.exec(e.cls),i=/(?:^| )(fakelink-[A-Za-z0-9]*)/.exec(e.cls);if(n&&n[1]&&e.cc.doAttrib(e.state,"link::"+n[1]),i){const t=pad.plugins.ep_full_hyperlinks.getMapfakeLinks()[i[1]];e.cc.doAttrib(e.state,"link::"+t)}return[]},generateLinkId:function(){return"lc-"+t(16)}};return{events:n,linkBoxes:S,linkIcons:O,linkL10n:J,newLink:W,preLinkMark:B,timeFormat:X,shared:G}})();
//# sourceMappingURL=ep.full.hyperlinks.mini.js.map
