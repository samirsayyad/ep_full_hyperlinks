"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}Object.defineProperty(exports,"__esModule",{value:!0});var e="object"==("undefined"==typeof self?"undefined":t(self))&&self.self===self&&self||"object"==("undefined"==typeof global?"undefined":t(global))&&global.global===global&&global||Function("return this")()||{},n=Array.prototype,r=Object.prototype,i="undefined"!=typeof Symbol?Symbol.prototype:null,o=n.push,a=n.slice,l=r.toString,c=r.hasOwnProperty,s="undefined"!=typeof ArrayBuffer,u="undefined"!=typeof DataView,p=Array.isArray,f=Object.keys,d=Object.create,h=s&&ArrayBuffer.isView,k=isNaN,y=isFinite,m=!{toString:null}.propertyIsEnumerable("toString"),g=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],v=Math.pow(2,53)-1;function b(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),r=Array(n),i=0;i<n;i++)r[i]=arguments[i+e];switch(e){case 0:return t.call(this,r);case 1:return t.call(this,arguments[0],r);case 2:return t.call(this,arguments[0],arguments[1],r)}var o=Array(e+1);for(i=0;i<e;i++)o[i]=arguments[i];return o[e]=r,t.apply(this,o)}}function _(e){var n=t(e);return"function"===n||"object"===n&&!!e}function x(t){return void 0===t}function w(t){return!0===t||!1===t||"[object Boolean]"===l.call(t)}function L(t){var e="[object "+t+"]";return function(t){return l.call(t)===e}}var S=L("String"),I=L("Number"),T=L("Date"),A=L("RegExp"),O=L("Error"),E=L("Symbol"),j=L("ArrayBuffer"),M=L("Function"),C=e.document&&e.document.childNodes;"function"!=typeof/./&&"object"!=("undefined"==typeof Int8Array?"undefined":t(Int8Array))&&"function"!=typeof C&&(M=function(t){return"function"==typeof t||!1});var V=M,D=L("Object"),N=u&&D(new DataView(new ArrayBuffer(8))),R="undefined"!=typeof Map&&D(new Map),B=L("DataView");var W=N?function(t){return null!=t&&V(t.getInt8)&&j(t.buffer)}:B,F=p||L("Array");function P(t,e){return null!=t&&c.call(t,e)}var H=L("Arguments");!function(){H(arguments)||(H=function(t){return P(t,"callee")})}();var U=H;function z(t){return I(t)&&k(t)}function q(t){return function(){return t}}function X(t){return function(e){var n=t(e);return"number"==typeof n&&n>=0&&n<=v}}function Y(t){return function(e){return null==e?void 0:e[t]}}var Z=Y("byteLength"),K=X(Z),J=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;var G=s?function(t){return h?h(t)&&!W(t):K(t)&&J.test(l.call(t))}:q(!1),Q=Y("length");function tt(t,e){e=function(t){for(var e={},n=t.length,r=0;r<n;++r)e[t[r]]=!0;return{contains:function(t){return!0===e[t]},push:function(n){return e[n]=!0,t.push(n)}}}(e);var n=g.length,i=t.constructor,o=V(i)&&i.prototype||r,a="constructor";for(P(t,a)&&!e.contains(a)&&e.push(a);n--;)(a=g[n])in t&&t[a]!==o[a]&&!e.contains(a)&&e.push(a)}function et(t){if(!_(t))return[];if(f)return f(t);var e=[];for(var n in t)P(t,n)&&e.push(n);return m&&tt(t,e),e}function nt(t,e){var n=et(e),r=n.length;if(null==t)return!r;for(var i=Object(t),o=0;o<r;o++){var a=n[o];if(e[a]!==i[a]||!(a in i))return!1}return!0}function rt(t){return t instanceof rt?t:this instanceof rt?void(this._wrapped=t):new rt(t)}function it(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,Z(t))}rt.VERSION="1.13.4",rt.prototype.value=function(){return this._wrapped},rt.prototype.valueOf=rt.prototype.toJSON=rt.prototype.value,rt.prototype.toString=function(){return String(this._wrapped)};function ot(e,n,r,i){if(e===n)return 0!==e||1/e==1/n;if(null==e||null==n)return!1;if(e!=e)return n!=n;var o=t(e);return("function"===o||"object"===o||"object"==t(n))&&at(e,n,r,i)}function at(e,n,r,o){e instanceof rt&&(e=e._wrapped),n instanceof rt&&(n=n._wrapped);var a=l.call(e);if(a!==l.call(n))return!1;if(N&&"[object Object]"==a&&W(e)){if(!W(n))return!1;a="[object DataView]"}switch(a){case"[object RegExp]":case"[object String]":return""+e==""+n;case"[object Number]":return+e!=+e?+n!=+n:0==+e?1/+e==1/n:+e==+n;case"[object Date]":case"[object Boolean]":return+e==+n;case"[object Symbol]":return i.valueOf.call(e)===i.valueOf.call(n);case"[object ArrayBuffer]":case"[object DataView]":return at(it(e),it(n),r,o)}var c="[object Array]"===a;if(!c&&G(e)){if(Z(e)!==Z(n))return!1;if(e.buffer===n.buffer&&e.byteOffset===n.byteOffset)return!0;c=!0}if(!c){if("object"!=t(e)||"object"!=t(n))return!1;var s=e.constructor,u=n.constructor;if(s!==u&&!(V(s)&&s instanceof s&&V(u)&&u instanceof u)&&"constructor"in e&&"constructor"in n)return!1}o=o||[];for(var p=(r=r||[]).length;p--;)if(r[p]===e)return o[p]===n;if(r.push(e),o.push(n),c){if((p=e.length)!==n.length)return!1;for(;p--;)if(!ot(e[p],n[p],r,o))return!1}else{var f,d=et(e);if(p=d.length,et(n).length!==p)return!1;for(;p--;)if(!P(n,f=d[p])||!ot(e[f],n[f],r,o))return!1}return r.pop(),o.pop(),!0}function lt(t){if(!_(t))return[];var e=[];for(var n in t)e.push(n);return m&&tt(t,e),e}function ct(t){var e=Q(t);return function(n){if(null==n)return!1;var r=lt(n);if(Q(r))return!1;for(var i=0;i<e;i++)if(!V(n[t[i]]))return!1;return t!==dt||!V(n[st])}}var st="forEach",ut=["clear","delete"],pt=["get","has","set"],ft=ut.concat(st,pt),dt=ut.concat(pt),ht=["add"].concat(ut,st,"has"),kt=R?ct(ft):L("Map"),yt=R?ct(dt):L("WeakMap"),mt=R?ct(ht):L("Set"),gt=L("WeakSet");function vt(t){for(var e=et(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=t[e[i]];return r}function bt(t){for(var e={},n=et(t),r=0,i=n.length;r<i;r++)e[t[n[r]]]=n[r];return e}function _t(t){var e=[];for(var n in t)V(t[n])&&e.push(n);return e.sort()}function xt(t,e){return function(n){var r=arguments.length;if(e&&(n=Object(n)),r<2||null==n)return n;for(var i=1;i<r;i++)for(var o=arguments[i],a=t(o),l=a.length,c=0;c<l;c++){var s=a[c];e&&void 0!==n[s]||(n[s]=o[s])}return n}}var wt=xt(lt),$t=xt(et),Lt=xt(lt,!0);function St(t){if(!_(t))return{};if(d)return d(t);var e=function(){};e.prototype=t;var n=new e;return e.prototype=null,n}function It(t){return F(t)?t:[t]}function Tt(t){return rt.toPath(t)}function At(t,e){for(var n=e.length,r=0;r<n;r++){if(null==t)return;t=t[e[r]]}return n?t:void 0}function Ot(t,e,n){var r=At(t,Tt(e));return x(r)?n:r}function Et(t){return t}function jt(t){return t=$t({},t),function(e){return nt(e,t)}}function Mt(t){return t=Tt(t),function(e){return At(e,t)}}function Ct(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,r,i){return t.call(e,n,r,i)};case 4:return function(n,r,i,o){return t.call(e,n,r,i,o)}}return function(){return t.apply(e,arguments)}}function Vt(t,e,n){return null==t?Et:V(t)?Ct(t,e,n):_(t)&&!F(t)?jt(t):Mt(t)}function Dt(t,e){return Vt(t,e,1/0)}function Nt(t,e,n){return rt.iteratee!==Dt?rt.iteratee(t,e):Vt(t,e,n)}function Rt(){}function Bt(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}rt.toPath=It,rt.iteratee=Dt;var Wt=Date.now||function(){return(new Date).getTime()};function Ft(t){var e=function(e){return t[e]},n="(?:"+et(t).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(t){return t=null==t?"":""+t,r.test(t)?t.replace(i,e):t}}var Pt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Ht=Ft(Pt),Ut=Ft(bt(Pt)),zt=rt.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},qt=/(.)^/,Xt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Yt=/\\|'|\r|\n|\u2028|\u2029/g;function Zt(t){return"\\"+Xt[t]}var Kt=/^\s*(\w|\$)+\s*$/;var Jt=0;function Gt(t,e,n,r,i){if(!(r instanceof e))return t.apply(n,i);var o=St(t.prototype),a=t.apply(o,i);return _(a)?a:o}var Qt=b((function(t,e){var n=Qt.placeholder;return function r(){for(var i=0,o=e.length,a=Array(o),l=0;l<o;l++)a[l]=e[l]===n?arguments[i++]:e[l];for(;i<arguments.length;)a.push(arguments[i++]);return Gt(t,r,this,this,a)}}));Qt.placeholder=rt;var te=b((function(t,e,n){if(!V(t))throw new TypeError("Bind must be called on a function");var r=b((function(i){return Gt(t,r,e,this,n.concat(i))}));return r})),ee=X(Q);function ne(t,e,n,r){if(r=r||[],e||0===e){if(e<=0)return r.concat(t)}else e=1/0;for(var i=r.length,o=0,a=Q(t);o<a;o++){var l=t[o];if(ee(l)&&(F(l)||U(l)))if(e>1)ne(l,e-1,n,r),i=r.length;else for(var c=0,s=l.length;c<s;)r[i++]=l[c++];else n||(r[i++]=l)}return r}var re=b((function(t,e){var n=(e=ne(e,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=e[n];t[r]=te(t[r],t)}return t}));var ie=b((function(t,e,n){return setTimeout((function(){return t.apply(null,n)}),e)})),oe=Qt(ie,rt,1);function ae(t){return function(){return!t.apply(this,arguments)}}function le(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}}var ce=Qt(le,2);function se(t,e,n){e=Nt(e,n);for(var r,i=et(t),o=0,a=i.length;o<a;o++)if(e(t[r=i[o]],r,t))return r}function ue(t){return function(e,n,r){n=Nt(n,r);for(var i=Q(e),o=t>0?0:i-1;o>=0&&o<i;o+=t)if(n(e[o],o,e))return o;return-1}}var pe=ue(1),fe=ue(-1);function de(t,e,n,r){for(var i=(n=Nt(n,r,1))(e),o=0,a=Q(t);o<a;){var l=Math.floor((o+a)/2);n(t[l])<i?o=l+1:a=l}return o}function he(t,e,n){return function(r,i,o){var l=0,c=Q(r);if("number"==typeof o)t>0?l=o>=0?o:Math.max(o+c,l):c=o>=0?Math.min(o+1,c):o+c+1;else if(n&&o&&c)return r[o=n(r,i)]===i?o:-1;if(i!=i)return(o=e(a.call(r,l,c),z))>=0?o+l:-1;for(o=t>0?l:c-1;o>=0&&o<c;o+=t)if(r[o]===i)return o;return-1}}var ke=he(1,pe,de),ye=he(-1,fe);function me(t,e,n){var r=(ee(t)?pe:se)(t,e,n);if(void 0!==r&&-1!==r)return t[r]}function ge(t,e,n){var r,i;if(e=Ct(e,n),ee(t))for(r=0,i=t.length;r<i;r++)e(t[r],r,t);else{var o=et(t);for(r=0,i=o.length;r<i;r++)e(t[o[r]],o[r],t)}return t}function ve(t,e,n){e=Nt(e,n);for(var r=!ee(t)&&et(t),i=(r||t).length,o=Array(i),a=0;a<i;a++){var l=r?r[a]:a;o[a]=e(t[l],l,t)}return o}function be(t){var e=function(e,n,r,i){var o=!ee(e)&&et(e),a=(o||e).length,l=t>0?0:a-1;for(i||(r=e[o?o[l]:l],l+=t);l>=0&&l<a;l+=t){var c=o?o[l]:l;r=n(r,e[c],c,e)}return r};return function(t,n,r,i){var o=arguments.length>=3;return e(t,Ct(n,i,4),r,o)}}var _e=be(1),xe=be(-1);function we(t,e,n){var r=[];return e=Nt(e,n),ge(t,(function(t,n,i){e(t,n,i)&&r.push(t)})),r}function $e(t,e,n){e=Nt(e,n);for(var r=!ee(t)&&et(t),i=(r||t).length,o=0;o<i;o++){var a=r?r[o]:o;if(!e(t[a],a,t))return!1}return!0}function Le(t,e,n){e=Nt(e,n);for(var r=!ee(t)&&et(t),i=(r||t).length,o=0;o<i;o++){var a=r?r[o]:o;if(e(t[a],a,t))return!0}return!1}function Se(t,e,n,r){return ee(t)||(t=vt(t)),("number"!=typeof n||r)&&(n=0),ke(t,e,n)>=0}var Ie=b((function(t,e,n){var r,i;return V(e)?i=e:(e=Tt(e),r=e.slice(0,-1),e=e[e.length-1]),ve(t,(function(t){var o=i;if(!o){if(r&&r.length&&(t=At(t,r)),null==t)return;o=t[e]}return null==o?o:o.apply(t,n)}))}));function Te(t,e){return ve(t,Mt(e))}function Ae(e,n,r){var i,o,a=-1/0,l=-1/0;if(null==n||"number"==typeof n&&"object"!=t(e[0])&&null!=e)for(var c=0,s=(e=ee(e)?e:vt(e)).length;c<s;c++)null!=(i=e[c])&&i>a&&(a=i);else n=Nt(n,r),ge(e,(function(t,e,r){((o=n(t,e,r))>l||o===-1/0&&a===-1/0)&&(a=t,l=o)}));return a}var Oe=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Ee(t){return t?F(t)?a.call(t):S(t)?t.match(Oe):ee(t)?ve(t,Et):vt(t):[]}function je(t,e,n){if(null==e||n)return ee(t)||(t=vt(t)),t[Bt(t.length-1)];var r=Ee(t),i=Q(r);e=Math.max(Math.min(e,i),0);for(var o=i-1,a=0;a<e;a++){var l=Bt(a,o),c=r[a];r[a]=r[l],r[l]=c}return r.slice(0,e)}function Me(t,e){return function(n,r,i){var o=e?[[],[]]:{};return r=Nt(r,i),ge(n,(function(e,i){var a=r(e,i,n);t(o,e,a)})),o}}var Ce=Me((function(t,e,n){P(t,n)?t[n].push(e):t[n]=[e]})),Ve=Me((function(t,e,n){t[n]=e})),De=Me((function(t,e,n){P(t,n)?t[n]++:t[n]=1})),Ne=Me((function(t,e,n){t[n?0:1].push(e)}),!0);function Re(t,e,n){return e in n}var Be=b((function(t,e){var n={},r=e[0];if(null==t)return n;V(r)?(e.length>1&&(r=Ct(r,e[1])),e=lt(t)):(r=Re,e=ne(e,!1,!1),t=Object(t));for(var i=0,o=e.length;i<o;i++){var a=e[i],l=t[a];r(l,a,t)&&(n[a]=l)}return n})),We=b((function(t,e){var n,r=e[0];return V(r)?(r=ae(r),e.length>1&&(n=e[1])):(e=ve(ne(e,!1,!1),String),r=function(t,n){return!Se(e,n)}),Be(t,r,n)}));function Fe(t,e,n){return a.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))}function Pe(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[0]:Fe(t,t.length-e)}function He(t,e,n){return a.call(t,null==e||n?1:e)}var Ue=b((function(t,e){return e=ne(e,!0,!0),we(t,(function(t){return!Se(e,t)}))})),ze=b((function(t,e){return Ue(t,e)}));function qe(t,e,n,r){w(e)||(r=n,n=e,e=!1),null!=n&&(n=Nt(n,r));for(var i=[],o=[],a=0,l=Q(t);a<l;a++){var c=t[a],s=n?n(c,a,t):c;e&&!n?(a&&o===s||i.push(c),o=s):n?Se(o,s)||(o.push(s),i.push(c)):Se(i,c)||i.push(c)}return i}var Xe=b((function(t){return qe(ne(t,!0,!0))}));function Ye(t){for(var e=t&&Ae(t,Q).length||0,n=Array(e),r=0;r<e;r++)n[r]=Te(t,r);return n}var Ze=b(Ye);function Ke(t,e){return t._chain?rt(e).chain():e}function Je(t){return ge(_t(t),(function(e){var n=rt[e]=t[e];rt.prototype[e]=function(){var t=[this._wrapped];return o.apply(t,arguments),Ke(this,n.apply(rt,t))}})),rt}ge(["pop","push","reverse","shift","sort","splice","unshift"],(function(t){var e=n[t];rt.prototype[t]=function(){var n=this._wrapped;return null!=n&&(e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0]),Ke(this,n)}})),ge(["concat","join","slice"],(function(t){var e=n[t];rt.prototype[t]=function(){var t=this._wrapped;return null!=t&&(t=e.apply(t,arguments)),Ke(this,t)}}));var Ge=Object.freeze({__proto__:null,VERSION:"1.13.4",restArguments:b,isObject:_,isNull:function(t){return null===t},isUndefined:x,isBoolean:w,isElement:function(t){return!(!t||1!==t.nodeType)},isString:S,isNumber:I,isDate:T,isRegExp:A,isError:O,isSymbol:E,isArrayBuffer:j,isDataView:W,isArray:F,isFunction:V,isArguments:U,isFinite:function(t){return!E(t)&&y(t)&&!isNaN(parseFloat(t))},isNaN:z,isTypedArray:G,isEmpty:function(t){if(null==t)return!0;var e=Q(t);return"number"==typeof e&&(F(t)||S(t)||U(t))?0===e:0===Q(et(t))},isMatch:nt,isEqual:function(t,e){return ot(t,e)},isMap:kt,isWeakMap:yt,isSet:mt,isWeakSet:gt,keys:et,allKeys:lt,values:vt,pairs:function(t){for(var e=et(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=[e[i],t[e[i]]];return r},invert:bt,functions:_t,methods:_t,extend:wt,extendOwn:$t,assign:$t,defaults:Lt,create:function(t,e){var n=St(t);return e&&$t(n,e),n},clone:function(t){return _(t)?F(t)?t.slice():wt({},t):t},tap:function(t,e){return e(t),t},get:Ot,has:function(t,e){for(var n=(e=Tt(e)).length,r=0;r<n;r++){var i=e[r];if(!P(t,i))return!1;t=t[i]}return!!n},mapObject:function(t,e,n){e=Nt(e,n);for(var r=et(t),i=r.length,o={},a=0;a<i;a++){var l=r[a];o[l]=e(t[l],l,t)}return o},identity:Et,constant:q,noop:Rt,toPath:It,property:Mt,propertyOf:function(t){return null==t?Rt:function(e){return Ot(t,e)}},matcher:jt,matches:jt,times:function(t,e,n){var r=Array(Math.max(0,t));e=Ct(e,n,1);for(var i=0;i<t;i++)r[i]=e(i);return r},random:Bt,now:Wt,escape:Ht,unescape:Ut,templateSettings:zt,template:function(t,e,n){!e&&n&&(e=n),e=Lt({},e,rt.templateSettings);var r=RegExp([(e.escape||qt).source,(e.interpolate||qt).source,(e.evaluate||qt).source].join("|")+"|$","g"),i=0,o="__p+='";t.replace(r,(function(e,n,r,a,l){return o+=t.slice(i,l).replace(Yt,Zt),i=l+e.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?o+="'+\n((__t=("+r+"))==null?'':__t)+\n'":a&&(o+="';\n"+a+"\n__p+='"),e})),o+="';\n";var a,l=e.variable;if(l){if(!Kt.test(l))throw new Error("variable is not a bare identifier: "+l)}else o="with(obj||{}){\n"+o+"}\n",l="obj";o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{a=new Function(l,"_",o)}catch(t){throw t.source=o,t}var c=function(t){return a.call(this,t,rt)};return c.source="function("+l+"){\n"+o+"}",c},result:function(t,e,n){var r=(e=Tt(e)).length;if(!r)return V(n)?n.call(t):n;for(var i=0;i<r;i++){var o=null==t?void 0:t[e[i]];void 0===o&&(o=n,i=r),t=V(o)?o.call(t):o}return t},uniqueId:function(t){var e=++Jt+"";return t?t+e:e},chain:function(t){var e=rt(t);return e._chain=!0,e},iteratee:Dt,partial:Qt,bind:te,bindAll:re,memoize:function(t,e){var n=function n(r){var i=n.cache,o=""+(e?e.apply(this,arguments):r);return P(i,o)||(i[o]=t.apply(this,arguments)),i[o]};return n.cache={},n},delay:ie,defer:oe,throttle:function(t,e,n){var r,i,o,a,l=0;n||(n={});var c=function(){l=!1===n.leading?0:Wt(),r=null,a=t.apply(i,o),r||(i=o=null)},s=function(){var s=Wt();l||!1!==n.leading||(l=s);var u=e-(s-l);return i=this,o=arguments,u<=0||u>e?(r&&(clearTimeout(r),r=null),l=s,a=t.apply(i,o),r||(i=o=null)):r||!1===n.trailing||(r=setTimeout(c,u)),a};return s.cancel=function(){clearTimeout(r),l=0,r=i=o=null},s},debounce:function(t,e,n){var r,i,o,a,l,c=function c(){var s=Wt()-i;e>s?r=setTimeout(c,e-s):(r=null,n||(a=t.apply(l,o)),r||(o=l=null))},s=b((function(s){return l=this,o=s,i=Wt(),r||(r=setTimeout(c,e),n&&(a=t.apply(l,o))),a}));return s.cancel=function(){clearTimeout(r),r=o=l=null},s},wrap:function(t,e){return Qt(e,t)},negate:ae,compose:function(){var t=arguments,e=t.length-1;return function(){for(var n=e,r=t[e].apply(this,arguments);n--;)r=t[n].call(this,r);return r}},after:function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},before:le,once:ce,findKey:se,findIndex:pe,findLastIndex:fe,sortedIndex:de,indexOf:ke,lastIndexOf:ye,find:me,detect:me,findWhere:function(t,e){return me(t,jt(e))},each:ge,forEach:ge,map:ve,collect:ve,reduce:_e,foldl:_e,inject:_e,reduceRight:xe,foldr:xe,filter:we,select:we,reject:function(t,e,n){return we(t,ae(Nt(e)),n)},every:$e,all:$e,some:Le,any:Le,contains:Se,includes:Se,include:Se,invoke:Ie,pluck:Te,where:function(t,e){return we(t,jt(e))},max:Ae,min:function(e,n,r){var i,o,a=1/0,l=1/0;if(null==n||"number"==typeof n&&"object"!=t(e[0])&&null!=e)for(var c=0,s=(e=ee(e)?e:vt(e)).length;c<s;c++)null!=(i=e[c])&&i<a&&(a=i);else n=Nt(n,r),ge(e,(function(t,e,r){((o=n(t,e,r))<l||o===1/0&&a===1/0)&&(a=t,l=o)}));return a},shuffle:function(t){return je(t,1/0)},sample:je,sortBy:function(t,e,n){var r=0;return e=Nt(e,n),Te(ve(t,(function(t,n,i){return{value:t,index:r++,criteria:e(t,n,i)}})).sort((function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return t.index-e.index})),"value")},groupBy:Ce,indexBy:Ve,countBy:De,partition:Ne,toArray:Ee,size:function(t){return null==t?0:ee(t)?t.length:et(t).length},pick:Be,omit:We,first:Pe,head:Pe,take:Pe,initial:Fe,last:function(t,e,n){return null==t||t.length<1?null==e||n?void 0:[]:null==e||n?t[t.length-1]:He(t,Math.max(0,t.length-e))},rest:He,tail:He,drop:He,compact:function(t){return we(t,Boolean)},flatten:function(t,e){return ne(t,e,!1)},without:ze,uniq:qe,unique:qe,union:Xe,intersection:function(t){for(var e=[],n=arguments.length,r=0,i=Q(t);r<i;r++){var o=t[r];if(!Se(e,o)){var a;for(a=1;a<n&&Se(arguments[a],o);a++);a===n&&e.push(o)}}return e},difference:Ue,unzip:Ye,transpose:Ye,zip:Ze,object:function(t,e){for(var n={},r=0,i=Q(t);r<i;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n},range:function(t,e,n){null==e&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var r=Math.max(Math.ceil((e-t)/n),0),i=Array(r),o=0;o<r;o++,t+=n)i[o]=t;return i},chunk:function(t,e){if(null==e||e<1)return[];for(var n=[],r=0,i=t.length;r<i;)n.push(a.call(t,r,r+=e));return n},mixin:Je,default:rt}),Qe=Je(Ge);Qe._=Qe;const tn=function(t){const e=t.match(/(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/);return{uri:e[0],scheme:e[1],authority:e[2],path:e[3],query:e[4],fragment:e[5]}};const en=function(t){if(!t)return;if(/[^a-z0-9\:\/\?\#\[\]\@\!\$\&\'\(\)\*\+\,\;\=\.\-\_\~\%]/i.test(t))return;if(/%[^0-9a-f]/i.test(t))return;if(/%[0-9a-f](:?[^0-9a-f]|$)/i.test(t))return;let e=[],n="",r="",i="",o="",a="",l="";if(e=tn(t),n=e.scheme,r=e.authority,i=e.path,o=e.query,a=e.fragment,r&&r.length){if(0!==i.length&&!/^\//.test(i))return}else if(/^\/\//.test(i))return;return n&&n.length&&!/^[a-z][a-z0-9\+\-\.]*$/.test(n.toLowerCase())?void 0:(n&&n.length&&(l+=`${n}:`),r&&r.length&&(l+=`//${r}`),l+=i,o&&o.length&&(l+=`?${o}`),a&&a.length&&(l+=`#${a}`),l)};let nn;const rn=()=>nn=nn||$('iframe[name="ace_outer"]').contents(),on=()=>rn().find("#linkBoxWrapper"),an=t=>{on().find(`#${t}`).hide(),nn.find(`#show-form-${t}`).show(),nn.find(`#edit-form-${t}`).hide()},ln=()=>on().find(".link-container").hide(),cn=(t,e,n)=>{const r=(t=>{let e=0,n=0;return t||(t=window.event),t.pageX||t.pageY?(e=t.pageX,n=t.pageY):(t.clientX||t.clientY)&&(e=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:e,y:n}})(t),i=r.x,o=r.y,a=e.innerWidth(),l=e.outerHeight(!0),c=n.innerWidth(),s=n.outerHeight(!0),u=parseInt(n.css("padding-top")),p=parseInt($(t.target).offset().top),f=parseInt($(t.target).outerHeight(!0));let d=t.clientX+n.offset().left,h=p+f+u/2;c-i<a&&(d=c-a-16),s-o<l&&(h=s-l),$("body").hasClass("mobileView")||(h+=35),$("body").hasClass("mobileView")?(e.css({left:"50%",top:`${h}px`,transform:"translateX(-50%)",width:"96vw"}),e.find("a.ep_hyperlink_title").css({"margin-left":"4px"}),e.find(".ep_hyperlink_docs_bubble_button_container").css({"margin-left":"auto"})):e.css({left:`${d}px`,top:`${h}px`})},sn=function(t){t.preventDefault(),t.stopPropagation();const e=$(this).attr("href");if((t=>{const e=new URL(t);let n=!1;if(e.origin!==location.origin)return!1;if(e.origin===location.origin){const t=location.pathname.split("/").indexOf("p")>0,e=clientVars.padId,r=t?`/p/${e}`:`/${e}`;location.pathname.substring(0,r.length)===r&&(n=!0),clientVars.ep_singlePad.active&&(n=!0)}return n})(e)){const t=new URL(e);let n=`${t.search}`;const r=(t=>{const e=[],n=clientVars.padId,r=t.pathname.split("/");let i=r.indexOf(n)+1;clientVars.ep_singlePad.active&&(i=0);const o=[...r].splice(i,r.length-1);return e.push(...o),e})(t);if(r.length>0){n=location.pathname.split("/").indexOf("p")>0?"/p":"",clientVars.ep_singlePad.active||(n+=`/${clientVars.padId}`),n+=`/${r.join("/")}${t.search}`}0===t.search.length&&(n=e);const i=r.length>0?"filter":"other";window.history.pushState({type:"hyperLink",href:e,target:i},document.title,n),ln()}else window.open(e,"_blank");return!1},un=t=>{const e=$(document).find("#newLink"),n=(t=>({text:t.find("#hyperlink-text").val(),oldText:t.find("#hyperlink-text-hidden").val(),hyperlink:t.find("#hyperlink-url").val()}))(e);return tn(n.hyperlink).scheme||(n.hyperlink=`https://${n.hyperlink}`),n.text.length>0&&en(n.hyperlink)?(e.find("#hyperlink-text, #hyperlink-url").removeClass("error"),fn(),t(n,0)):(0===n.text.length&&e.find("#hyperlink-text").addClass("error"),en(n.hyperlink)||e.find("#hyperlink-url").addClass("error")),!1},pn=(t,e)=>{$("#newLink").remove(),t.linkId="";const n=$("#newLinkTemplate").tmpl(t);return n.appendTo($("#editorcontainerbox")),$("#newLink #link-cancel-btn").on("click",(t=>fn())),$("#newLink #link-create-btn").on("click",(t=>un(e))),$(document).on("submit","form.link-edit-form",(t=>{t.preventDefault(),un(e)})),n},fn=()=>{$("#newLink").removeClass("popup-show"),$("#newLink").find(":focus").blur(),pad.plugins.ep_full_hyperlinks.preLinkMarker.unmarkSelectedText()},dn="pre-selected-link",hn=function(t){this.ace=t;const e=this;this.highlightSelectedText()&&setTimeout((()=>{e.unmarkSelectedText()}),0)};hn.prototype.highlightSelectedText=function(){return clientVars.highlightSelectedText},hn.prototype.markSelectedText=function(){this.highlightSelectedText()&&this.ace.callWithAce(kn,"markPreSelectedTextToLink",!0)},hn.prototype.unmarkSelectedText=function(){this.highlightSelectedText()&&this.ace.callWithAce(kn,"unmarkPreSelectedTextToLink",!0)},hn.prototype.performNonUnduableEvent=function(t,e,n){e.startNewEvent("nonundoable"),n(),e.startNewEvent(t)},hn.prototype.handleMarkText=function(t){const e=t.editorInfo,n=t.rep,r=t.callstack;this.removeMarks(e,n,r),this.addMark(e,r)},hn.prototype.handleUnmarkText=function(t){const e=t.editorInfo,n=t.rep,r=t.callstack;this.removeMarks(e,n,r)},hn.prototype.addMark=function(t,e){const n=e.editEvent.eventType;this.performNonUnduableEvent(n,e,(()=>{t.ace_setAttributeOnSelection(dn,clientVars.userId)}))},hn.prototype.removeMarks=function(t,e,n){const r=n.editEvent.eventType,i=e.selStart,o=e.selEnd;this.performNonUnduableEvent(r,n,(()=>{const e=$('iframe[name="ace_outer"]').contents().find('iframe[name="ace_inner"]'),n=`.${dn}`,r=t.ace_getRepFromSelector(n,e);$.each(r,((e,n)=>{t.ace_performSelectionChange(n[0],n[1],!0),t.ace_setAttributeOnSelection(dn,!1)})),t.ace_performSelectionChange(i,o,!0)}))};const kn=()=>{},yn=(t,e,n,r)=>{t.preventDefault();const i=((t,e)=>{const n=t[0].contentWindow.getSelection().getRangeAt(0),r=document.createElement("div");r.append(n.cloneContents());try{r.querySelectorAll(".link").forEach((t=>{const n=t.getAttribute("class"),i=/(?:^| )(lc-[A-Za-z0-9]*)/.exec(n)[1];let o;e[i]?(o=document.createElement("a"),o.innerHTML=t.innerHTML,o.setAttribute("href",e[i].data.hyperlink)):(o=document.createElement("span"),o.innerHTML=t.innerHTML),r.querySelector(`.${i}`).replaceWith(o)}))}catch(t){console.error("[ep_full_hyperlinks]: copy data has an error",t)}return r})(e,r);t.originalEvent.clipboardData.setData("text/html",i.outerHTML),n&&e.contents()[0].execCommand("delete")},mn=(t,e)=>{((t,e)=>{const n=t.originalEvent.clipboardData.getData("text/html");if(!e.contents()[0].getSelection().getRangeAt(0))return!1;t.preventDefault();const r=document.createElement("div");r.innerHTML=n;const i=r.getElementsByTagName("a"),o={};for(const t of i){const e=t.href,n=t.innerHTML,r=shared.generateLinkId();t.className=r,t.id=r,o[r]={data:{author:"empty",linkId:r,timestamp:(new Date).getTime(),text:n,originalLinkId:r,hyperlink:e,headerId:null,date:new Date,formattedDate:new Date}}}pad.plugins.ep_full_hyperlinks.saveLinkWithoutSelection(clientVars.padId,o),e.contents()[0].execCommand("insertHTML",!1,$("<div>").append($(r).clone()).html())})(t,e)};require("ep_etherpad-lite/static/js/browser");const gn=["ep_full_hyperlinks/static/css/link.css"];function vn(t){this.container=null,this.padOuter=null,this.padInner=null,this.ace=t.ace;const e=document.location,n=""===e.port?"https:"===e.protocol?443:80:e.port,r=`${e.protocol}//${e.hostname}:${n}/link`;var i;this.padId=clientVars.padId,this.socket=io.connect(r,{query:`padId=${this.padId}`}),this.padId=clientVars.padId,this.links=[],this.mapFakeLinks=[],this.mapOriginalLinksId=[],this.init(),this.preLinkMarker=(i=this.ace,new hn(i))}function bn(t,e){const n=this.documentAttributeManager,r=[],i=e.contents().find(t);return $.each(i,((t,e)=>{const i=[[],[]],o=$(e).closest("div"),a=$(o).prevAll("div").length;i[0][0]=a,i[1][0]=a;let l=0,c=!1;const s=n.getAttributesOnLine(a);$.each(s,((t,e)=>{"lmkr"===e[0]&&(c=!0)})),c&&l++,$(e).prevAll("span").each((function(){const t=$(this).text().length;l+=t})),i[0][1]=l,$(e).text().length,i[1][1]=i[0][1]+$(e).text().length,r.push(i)})),r}vn.prototype.init=async function(){const t=this;this.ace,this.findContainers(),this.insertContainers();const e=await this.getLinks();$.isEmptyObject(e)||this.setLinks(e),this.linkListen(),this.pushLink("add",((t,e)=>{this.setLink(t,e)})),$(".addLink").on("click touchstart",(t=>{t.preventDefault(),this.displayNewLinkForm()}));this.container.parent().on("submit","form.link-edit-form",(async function(e){e.preventDefault(),e.stopPropagation();const n=$(this).closest(".link-container"),r=$(this).closest(".link-edit-form"),i=n.data("linkid"),o=r.find("#hyperlink-text").val();let a=r.find("#hyperlink-url").val();const l=r.find("#hyperlink-text-hidden").val();r.find(".link-text-text-old").val(o);const c=$('iframe[name="ace_outer"]').contents().find('iframe[name="ace_inner"]'),s=`.${i}`,u=t.ace;u.callWithAce((t=>{const e=t.ace_getRepFromSelector(s,c);l!==o&&(t.ace_replaceRange(e[0][0],e[0][1],o),l.length>o.length?e[0][1][1]-=l.length-o.length:l.length<o.length&&(e[0][1][1]+=o.length-l.length)),u.callWithAce((t=>{t.ace_performSelectionChange(e[0][0],e[0][1],!0),t.ace_setAttributeOnSelection("link",i)}))}),"editLinkedSelection",!0),/^http:\/\//.test(a)||/^https:\/\//.test(a)||(a=`http://${a}`);const p={};p.linkId=i,p.padId=clientVars.padId,p.linkText=o,p.oldLinkText=l,p.hyperlink=a;try{await t._send("updateLinkText",p)}catch(t){if("unauth"!==t.message)throw t;return}n.removeClass("editing"),t.updateLinkBoxText(i,o,a),an(i),t.padOuter.find(`#show-form-${i}`).show(),t.padOuter.find(`#edit-form-${i}`).hide(),n.attr({"data-loaded":!1}),t.setLinkNewText(i,o,a)})),this.container.on("click","#link-cancel-btn",(function(){const e=$(this).closest(".link-container")[0].id;t.padOuter.find(`#show-form-${e}`).show(),t.padOuter.find(`#edit-form-${e}`).hide(),an(e)}));let n;this.container.parent().on("click",".ep_hyperlink_docs_bubble_button_edit",(function(e){const n=$(this).closest(".link-container")[0].id;t.padOuter.find(`#show-form-${n}`).hide(),t.padOuter.find(`#edit-form-${n}`).show(),t.padOuter.find(`#edit-form-${n}`).find("#hyperlink-text").focus((function(){this.setSelectionRange(this.value.length,this.value.length)})).select(),clientVars.userAgent.isMobile&&(e=>{const n=$('iframe[name="ace_outer"]').contents().find("#outerdocbody").parent(),r=$("#mainHeader").innerHeight(),i=t.padOuter.find(`#edit-form-${e}`).closest(".link-container").offset().top-r-25;n.animate({scrollTop:i})})(n)})),this.container.parent().on("click",".ep_hyperlink_docs_bubble_button_copy",(function(t){const e=document.createElement("input");document.body.appendChild(e),e.value=this.getAttribute("data-hyperlink"),e.select(),document.execCommand("copy"),document.body.removeChild(e),$.gritter.add({text:"Link copied to clipboard"});const n=$(this).closest(".link-container")[0].id;an(n)})),this.container.parent().on("click",".ep_hyperlink_docs_bubble_button_delete",(async function(){const e=$(this).closest(".link-container")[0].id;t.deleteLink(e);const n=$('iframe[name="ace_outer"]').contents().find('iframe[name="ace_inner"]'),r=`.${e}`,i=t.ace;i.callWithAce((t=>{const e=t.ace_getRepFromSelector(r,n);$.each(e,((t,e)=>{i.callWithAce((t=>{t.ace_performSelectionChange(e[0],e[1],!0),t.ace_setAttributeOnSelection("link","link-deleted")}))}))}),"deleteLinkedSelection",!0);try{await t._send("deleteLink",{padId:t.padId,linkId:e,authorId:clientVars.userId})}catch(t){if("unauth"!==t.message)throw t;return}})),this.container.on("mouseover",".sidebar-link",(t=>{clearTimeout(n)})).on("mouseout",".sidebar-link",(t=>{n=setTimeout((()=>{const e=t.currentTarget.id;an(e)}),3e3)})),this.padInner.contents().on("click",".link",(e=>{e.preventDefault(),clearTimeout(n);const r=t.linkIdOf(e);fetch(`/pluginfw/hyperlink/${clientVars.padId}/links/${r}`).then((t=>t.json())).then((n=>{const i={...n.link,linkId:r};((t,e,n)=>{const r=$('iframe[name="ace_outer"]').contents(),i=rn().find('iframe[name="ace_inner"]'),o=e.linkId,a=0!==on().find(`#${o}`).length;if(ln(),!e.hyperlink)return console.error("[hyperlink]: link does not exist",e),!1;let l=on().find(`#${o}`);a||(l=$("#linkBoxTemplate").tmpl({...e}));const c=l.attr("data-loaded");a?(l.show(),e.hyperlink!==l.find("a.ep_hyperlink_title").attr("href")&&l.attr("data-loaded","false"),l.attr("data-hyperlink",e.hyperlink),l.find("input#hyperlink-url").val(e.hyperlink),l.find("a.ep_hyperlink_title").attr({title:e.hyperlink,href:e.hyperlink})):r.find("#linkBoxWrapper").append(l);const s=i.contents().find(`.${o}`).text();if(l.find("input#hyperlink-text-hidden").val(s),l.find("input#hyperlink-text").val(s),"true"!=c){let t,r=e.hyperlink||l.attr("data-hyperlink");try{t=new URL(r)}catch(t){return console.error(`[hyperlink]: ${t}`),void an(o)}const i=l.find("#ep_hyperlink_img"),a=l.find("a.ep_hyperlink_title"),c=l.find("#card_loading_hyperlink"),s=l.find("#ep_hyperlink_description");s.text(""),a.text(r),i.hide(),a.show(),c.show(),/^http:\/\//.test(r)||/^https:\/\//.test(r)||(r=`https://${r}`);const u=function(t,e,n){i.attr("src",n),i.on("load",(()=>{c.fadeOut(500,(()=>{i.fadeIn(),a.text(e.replace(/^(?:https?:\/\/)?(?:www\.)?/i,"")),s.text(t.replace(/^(?:https?:\/\/)?(?:www\.)?/i,"")),l.attr({"data-loaded":!0})}))}))};if(!en(r))return u(r,r,"../static/plugins/ep_full_hyperlinks/static/dist/img/nometa.png"),!1;const p=function(e){if(e.metadata.image&&e.metadata.title)u(r,e.metadata.title,e.metadata.image);else{const i=`https://${t.hostname}`;!0!==e.last?n.emit("metaResolver",{padId:clientVars.padId,editedHyperlink:i,last:!0},p):u(r,e.metadata.title||r,"../static/plugins/ep_full_hyperlinks/static/dist/img/nometa.png")}};t.hostname.indexOf("twitter.com")>=0?u(r,"Twitter","../static/plugins/ep_full_hyperlinks/static/dist/img/twitter.png"):t.protocol.indexOf("mailto")>=0?u(r,"Send email","../static/plugins/ep_full_hyperlinks/static/dist/img/envelope.svg"):t.protocol.indexOf("skype")>=0?u(r,"Open Skype","../static/plugins/ep_full_hyperlinks/static/dist/img/skype.svg"):n.emit("metaResolver",{padId:clientVars.padId,hyperlink:r,last:!1},p)}cn(t,l,i),l.addClass("hyperlink-display")})(e,i,t.socket)}))})),this.container.parent().on("click","a.ep_hyperlink_title",sn),this.addListenersToCloseOpenedLink(),$("#options-links").trigger("change"),t.padInner.contents().on("copy",(e=>{yn(e,t.padInner,!1,t.links)})),t.padInner.contents().on("cut",(e=>{yn(e,t.padInner,!0,t.links)})),t.padInner.contents().on("paste",(e=>{mn(e,t.padInner)}))},vn.prototype.linkListen=function(){this.socket.on("pushAddLinkInBulk",(async()=>{const t=await this.getLinks();if(!$.isEmptyObject(t)){const e={};Qe.map(t,((t,n)=>{e[n]={},e[n].data=t})),this.Links=e}}))},vn.prototype.findContainers=function(){const t=$('iframe[name="ace_outer"]').contents();this.padOuter=t,this.padInner=t.find('iframe[name="ace_inner"]'),this.outerBody=t.find("#outerdocbody")},vn.prototype.setLinkNewText=function(t,e,n){this.links[t]?(this.links[t].data.text=e,this.links[t].data.hyperlink=n):this.linkReplies[t]&&(this.linkReplies[t].text=e,this.linkReplies[t].hyperlink=n)},vn.prototype.addListenersToCloseOpenedLink=function(){const t=this;$(document).on("touchstart click",(e=>{t.closeOpenedLinkIfNotOnSelectedElements(e)})),this.padOuter.find("html").on("touchstart click",(e=>{t.closeOpenedLinkIfNotOnSelectedElements(e)})),this.padInner.contents().find("html").on("touchstart click",(e=>{t.closeOpenedLinkIfNotOnSelectedElements(e)}))},vn.prototype.closeOpenedLink=function(t){ln()},vn.prototype.closeOpenedLinkIfNotOnSelectedElements=function(t){(function(t){return!!($(t.target).closest(".link").length||$(t.target).closest(".link-modal").length||$(t.target).closest(".ep_hyperlink_docs_bubble_button_edit").length||$(t.target).closest(".ep_hyperlink_docs_bubble_button_delete").length||$(t.target).closest(".ep_hyperlink_docs_bubble_button_copy").length||$(t.target).closest(".full-display-link").length||$(t.target).closest(".link-title-wrapper").length||$(t.target).closest(".link-edit-form").length||$(t.target).closest(".link-text-text").length||$(t.target).closest(".link-text-hyperlink").length)})(t)||this.closeOpenedLink(t)},vn.prototype.linkIdOf=function(t){const e=t.currentTarget.classList,n=/(?:^| )(lc-[A-Za-z0-9]*)/.exec(e);return n?n[1]:null},vn.prototype.insertContainers=function(){const t=$('iframe[name="ace_outer"]').contents().find("#outerdocbody").prepend('<div id="linkBoxWrapper"></div>');this.container=t},vn.prototype.setLinks=function(t){for(const e in t)this.setLink(e,t[e])},vn.prototype.setLink=function(t,e){const n=this.links;e.formattedDate=new Date(e.timestamp).toISOString(),null==n[t]&&(n[t]={}),n[t].data=e},vn.prototype.setLinkNewText=function(t,e,n){this.links[t]&&(this.links[t].data.text=e,this.links[t].data.hyperlink=n)},vn.prototype.getLinks=async function(){return(await this._send("getLinks",{padId:this.padId})).links},vn.prototype.getLinkData=function(){const t={};return t.padId=this.padId,t.link={},t.link.author=clientVars.userId,t.link.name=pad.myUserInfo.name,t.link.timestamp=(new Date).getTime(),void 0===t.link.name&&(t.link.name=clientVars.userAgent),t},vn.prototype.deleteLink=function(t){$('iframe[name="ace_outer"]').contents().find(`#${t}`).remove()},vn.prototype.displayNewLinkForm=function(){const t=this,e={};this.ace.callWithAce((t=>{const n=t.ace_getRep();e.lines=n.lines,e.selStart=n.selStart,e.selEnd=n.selEnd}),"saveLinkedSelection",!0);const n=t.getSelectedText(e);if(0===n.length)return void $.gritter.add({text:"Please first select the text to link"});t.createNewLinkFormIfDontExist(e),$("body").hasClass("mobileView")||$("#newLink").css("left",$(".toolbar .addLink").offset().left),$("#newLink").find("textarea").val(""),$("#newLink").find(".link-content, .to-value").removeClass("error"),$("#newLink").addClass("popup-show"),pad.plugins.ep_full_hyperlinks.preLinkMarker.markSelectedText(),setTimeout((()=>$("#newLink #hyperlink-url").focus().select()),500);const r=t.getFirstElementSelected();t.isElementInViewport(r)||t.scrollViewportIfSelectedTextIsNotVisible(r),$("#newLink").find("#hyperlink-text").val(n),$("#newLink").find("#hyperlink-text-hidden").val(n)},vn.prototype.scrollViewportIfSelectedTextIsNotVisible=function(t){const e=t.offsetTop,n=$('iframe[name="ace_outer"]').contents();n.find("#outerdocbody").scrollTop(e),n.find("#outerdocbody").parent().scrollTop(e)},vn.prototype.isElementInViewport=function(t){const e=t.getBoundingClientRect(),n=$('iframe[name="ace_outer"]').contents().find("#outerdocbody").parent().scrollTop(),r=$('iframe[name="ace_outer"]').contents().find("#outerdocbody").scrollTop()||n,i=e.top-r,o=e.bottom-r,a=$('iframe[name="ace_outer"]'),l=a.height(),c=this.getIntValueOfCSSProperty(a,"padding-top");return!(i<0||o>l-c)},vn.prototype.getIntValueOfCSSProperty=function(t,e){const n=t.css(e);return parseInt(n)||0},vn.prototype.getFirstElementSelected=function(){let t;return this.ace.callWithAce((e=>{const n=e.ace_getRep(),r=`#${n.lines.atIndex(n.selStart[0]).key}`,i=$('iframe[name="ace_outer"]').contents().find('iframe[name="ace_inner"]').contents();t=i.find(r)}),"getFirstElementSelected",!0),t[0]},vn.prototype.checkNoTextSelected=function(t){return t.selStart[0]==t.selEnd[0]&&t.selStart[1]==t.selEnd[1]},vn.prototype.createNewLinkFormIfDontExist=function(t){const e=this.getLinkData(),n=this;pn(e,((r,i)=>{e.link.oldText=r.oldText,e.link.text=r.text,e.link.hyperlink=r.hyperlink,n.saveLink(e,t)}))},vn.prototype.getSelectedText=function(t){const e=this,n=t.selStart[0],r=e.getLastLine(n,t);let i="";return Qe(Qe.range(n,r+1)).each((r=>{const o=t.lines.atIndex(r);if(t.selStart[0]===r)if(t.selStart[1]>0)var a=t.selStart[1];else a=0;if(t.selEnd[0]===r)if(t.selEnd[1]<=o.text.length)var l=t.selEnd[1];else l=0;let c=o.text.substring(a,l);r>n&&(c=e.cleanLine(o,c),c=`\n${c}`),i+=c})),i},vn.prototype.getLastLine=function(t,e){let n=e.selEnd[0];return n>t&&this.lastLineSelectedIsEmpty(e,n)&&n--,n},vn.prototype.lastLineSelectedIsEmpty=function(t,e){const n=t.lines.atIndex(e),r=this.lineHasMarker(n)?1:0;return t.selEnd[1]===r},vn.prototype.lineHasMarker=function(t){return 1===t.lineMarker},vn.prototype.cleanLine=function(t,e){return this.lineHasMarker(t)&&(e=e.substring(1)),e},vn.prototype.saveLink=async function(t,e){const n=await this._send("addLink",t);if(null==n)return;const[r,i]=n;i.linkId=r,this.ace.callWithAce((t=>{e=t.ace_getRep(),t.ace_performSelectionChange(e.selStart,e.selEnd,!0),t.ace_setAttributeOnSelection("link",r)}),"insertLink",!0),this.setLink(r,i)},vn.prototype.saveLinkWithoutSelection=async function(t,e){const n=this.buildLinks(e),r=await this._send("bulkAddLink",t,n);this.setLinks(r)},vn.prototype.buildLinks=function(t){return Qe.map(t,((t,e)=>this.buildLink(e,t.data)))},vn.prototype.buildLink=function(t,e){const n={};return n.padId=this.padId,n.linkId=t,n.text=e.text,n.hyperlink=e.hyperlink,n.changeTo=e.changeTo,n.changeFrom=e.changeFrom,n.name=e.name,n.timestamp=parseInt(e.timestamp),n},vn.prototype._send=async function(t,...e){return await new Promise(((n,r)=>{this.socket.emit(t,...e,((t,e)=>{if(null!=t)return r(Object.assign(new Error(t.message),{name:t.name}));n(e)}))}))},vn.prototype.getMapfakeLinks=function(){return this.mapFakeLinks},vn.prototype.findLinkText=function(t){return t.find(".compact-display-content .link-text-text, .full-display-link .link-title-wrapper .link-text-text")},vn.prototype.findHyperLinkText=function(t){return t.find(".compact-display-content .link-text-hyperlink, .full-display-link .link-title-wrapper .link-text-hyperlink")},vn.prototype.updateLinkBoxText=function(t,e,n){const r=this.container.parent().find(`[data-linkid='${t}']`);r.attr("data-hyperlink",n);this.findLinkText(r).val(e);this.findHyperLinkText(r).val(n)},vn.prototype.showChangeAsAccepted=function(t){const e=this,n=this.container.parent().find(`[data-linkid='${t}']`);n.closest(".sidebar-link").find(".link-container.change-accepted").addBack(".change-accepted").each((function(){$(this).removeClass("change-accepted");const t={linkId:$(this).attr("data-linkid"),padId:e.padId};e._send("revertChange",t)})),n.addClass("change-accepted")},vn.prototype.showChangeAsReverted=function(t){this.container.parent().find(`[data-linkid='${t}']`).removeClass("change-accepted")},vn.prototype.pushLink=function(t,e){const n=this.socket,r=this;n.on("textLinkUpdated",((t,e,n)=>{r.updateLinkBoxText(t,e,n)})),n.on("linkDeleted",(t=>{r.deleteLink(t)})),n.on("changeAccepted",(t=>{r.showChangeAsAccepted(t)})),n.on("changeReverted",(t=>{r.showChangeAsReverted(t)})),"add"===t&&n.on("pushAddLink",((t,n)=>{e(t,n)}))};const _n=(t,e,n)=>gn,xn=(t,e)=>{pad.plugins||(pad.plugins={});const n=new vn(e);return pad.plugins.ep_full_hyperlinks=n,$("#editorcontainerbox").hasClass("flex-layout")||$.gritter.add({title:"Error",text:"ep_full_hyperlinks: Please upgrade to etherpad 1.8.3 for this plugin to work correctly",sticky:!0,class_name:"error"}),[]},wn=(t,e,n)=>"link"===e.key&&"link-deleted"!==e.value?["link",e.value]:e.key===dn&&e.value===clientVars.userId?[dn,e.value]:[],$n=(t,e)=>{pad.plugins||(pad.plugins={});const n=e.callstack.editEvent.eventType;if("setup"!=n&&"setBaseText"!=n&&"importText"!=n)return"unmarkPreSelectedTextToLink"===n?pad.plugins.ep_full_hyperlinks.preLinkMarker.handleUnmarkText(e):"markPreSelectedTextToLink"===n&&pad.plugins.ep_full_hyperlinks.preLinkMarker.handleMarkText(e),[]},Ln=(t,e)=>{const n=/(?:^| )(lc-[A-Za-z0-9]*)/.exec(e.cls),r=/(?:^| )(fakelink-[A-Za-z0-9]*)/.exec(e.cls);if(n&&n[1]&&e.cc.doAttrib(e.state,`link::${n[1]}`),r){const t=pad.plugins.ep_full_hyperlinks.getMapfakeLinks()[r[1]];e.cc.doAttrib(e.state,`link::${t}`)}return[]};exports.aceAttribsToClasses=wn,exports.aceEditEvent=$n,exports.aceEditorCSS=_n,exports.aceInitialized=function(t,e){e.editorInfo.ace_getRepFromSelector=Qe(bn).bind(e)},exports.acePostWriteDomLineHTML=function(t,e){const n=$(e.node).find("a");n.length>0&&n.each((function(){$(this).on("click",sn)}))},exports.collectContentPre=Ln,exports.postAceInit=xn;//# sourceMappingURL=bundle.js.map
